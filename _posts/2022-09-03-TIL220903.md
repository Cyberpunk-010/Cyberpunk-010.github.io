---
title:  "TIL: Docker for pwnable ğŸ‹"
excerpt: "2022.09.03 TIL âœ"
toc: true
toc_sticky: true

categories:
  - TIL
  - Hacking
---
## Dockerë¡œ pwnable ë¬¸ì œ í’€ì´ í™˜ê²½ ì„¸íŒ…í•˜ê¸°

[https://sangjun.xyz/56](https://sangjun.xyz/56)

[https://sechack.tistory.com/57](https://sechack.tistory.com/57)

[https://dreamhack.io/forum/qna/2619](https://dreamhack.io/forum/qna/2619)

### Dockerë¥¼ ì„ íƒí•œ ì´ìœ 

- ê¸°ì¡´ WSL2ëŠ” Ubuntu 16.04ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŒ
- ë§ì€ pwnable ë¬¸ì œì—ì„œ Dockerfileë¥¼ ì œê³µí•¨
- imageë¥¼ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë‘ë©´ ê°ê° ë…ë¦½ëœ í™˜ê²½ì„ ê°€ì§„ containerë¥¼ ë¹ ë¥´ê²Œ ì‹¤í–‰í•  ìˆ˜ ìˆìŒ
- vmwareë³´ë‹¤ ë¹ ë¦„

### Dockerë¥¼ ì´ìš©í•œ pwnable ë¬¸ì œ í’€ì´ í™˜ê²½

[dreamhackì— ì˜¬ë¦° ì§ˆë¬¸ê¸€](https://dreamhack.io/forum/qna/2619)ë¡œë¶€í„° ì¡°ì–¸ ë°›ì€ ëŒ€ë¡œ Ubuntu version ë³„ë¡œ imageë¥¼ ë§Œë“¤ê³ , containerë¥¼ ìƒì„±í•´ì„œ ë¬¸ì œë¥¼ í’€ê¸°ë¡œ í–ˆë‹¤. ë¬¸ì œì—ì„œ ì£¼ì–´ì§€ëŠ” docker fileì„ ì½ê³  ì´ì— ì•Œë§ì€ Ubuntu versionì„ ì‚¬ìš©í•˜ê³ , libc ë²„ì „ ê°™ì€ ê²½ìš°ëŠ” docker fileë¥¼ ì½ì–´ ì•Œì•„ë‚´ê¸°ë¡œ í–ˆë‹¤. ì´ë ‡ê²Œ í•´ë„ ì•ˆí’€ë¦´ ê²½ìš°ì—ëŠ” ë¬¸ì œì—ì„œ ì£¼ì–´ì§€ëŠ” dockerfileë¡œ containerë¥¼ ìƒì„±í•´ì„œ libc íŒŒì¼ë§Œ ë¹¼ë‚´ê¸°ë¡œ í–ˆë‹¤.

### Dockerfileë¡œë¶€í„° image ë¹Œë“œí•˜ê¸°

1. [ë§í¬](https://goddaehee.tistory.com/251)ë¥¼ ë”°ë¼ docker desktopì„ ì„¤ì¹˜í•œë‹¤.
2. DockerfileëŠ” [ì—¬ê¸°](https://sechack.tistory.com/57)ì— ìˆëŠ” íŒŒì¼ë“¤ì„ ì‚¬ìš©í–ˆë‹¤. 16.04, 18.04, 20.04 ë²„ì „ì˜ Dockerfileë¥¼ ê°ê° ë‹¤ë¥¸ í´ë”ì— ìƒì„±í•œë‹¤.
3. cmdì—ì„œ ê° í´ë”ë¡œ ì´ë™í•´ `docker build -t [imagename]:[tag] .`ë¥¼ ì…ë ¥í•œë‹¤. image nameì€ ëª¨ë‘ pwnìœ¼ë¡œ í†µì¼í–ˆê³ , tagëŠ” ê°ê° Ubuntuì˜ ë²„ì „ìœ¼ë¡œ ì ì—ˆë‹¤.
4. ê° ì´ë¯¸ì§€ ë³„ë¡œ ë¹Œë“œí•˜ëŠ” ë°ì— ì•½ 16ë¶„ ì •ë„ì˜ ì‹œê°„ì´ ì†Œìš”ë˜ì—ˆë‹¤.

<p align="center">
    <a href="/assets/images/TIL220903/Untitled.png">
        <img src="/assets/images/TIL220903/Untitled.png" width="400">
    </a>
</p>

### imageë¡œë¶€í„° container ìƒì„± ë° ì‹¤í–‰í•˜ê¸°

ì•„ë˜ì™€ ê°™ì´ docker desktopì—ì„œ containerë¥¼ runí•˜ë‹ˆ ì—¬ëŸ¬ê°€ì§€ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤:

<p align="center">
    <a href="/assets/images/TIL220903/Untitled (1).png">
        <img src="/assets/images/TIL220903/Untitled (1).png" width="400">
    </a>
</p>

- gdbë¡œ debuggingì„ í•  ë•Œ `warning: Error disabling address space randomization: Operation not permitted`ë¼ëŠ” ì—ëŸ¬ ë¬¸êµ¬ê°€ ë–´ë‹¤.
- containerë¡œ ë¬¸ì œ íŒŒì¼ë“¤ì„ ë„£ì–´ì¤„ ë•Œ `docker cp` êµ¬ë¬¸ì„ ì‚¬ìš©í•´ì•¼ í–ˆëŠ”ë°, ë¶ˆí¸í•¨ì´ ì»¸ë‹¤.

ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ runì„ í•  ë•Œ ì•„ë˜ì™€ ê°™ì´ optionì„ ë„£ì–´ì¤¬ë‹¤.

`docker run --name [container name] -v [host path]:[mounting point path in container] --cap-add=SYS_PTRACE --security-opt seccomp=unconfined -ti [image id]`

- `--name [container name]`: containerì˜ ì´ë¦„ì„ ì§€ì •
- `-v [host path]:[mounting point path in container]`: host pathì™€ mounting point path in containerê°€ ê°™ì€ í´ë”ë¥¼ ê³µìœ í•˜ë„ë¡ í•œë‹¤. â†’ ë¬¸ì œ íŒŒì¼ë“¤ì„ containerë¡œ ì˜®ê¸°ê¸° ë§¤ìš° í¸í•¨!!
- `--cap-add=SYS_PTRACE --security-opt seccomp=unconfined`: [ì—¬ê¸°](https://stackoverflow.com/questions/35860527/warning-error-disabling-address-space-randomization-operation-not-permitted)ì—ì„œ ìœ„ì—ì„œ ì–¸ê¸‰í•œ gdb ê´€ë ¨ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ë¼ê³  ì•Œë ¤ì¤€ optionì´ë‹¤.
- `-ti`: ì´ optionì„ ë„£ì§€ ì•Šìœ¼ë©´ containerê°€ ì‹¤í–‰ë˜ìë§ˆì exití•˜ê¸° ë•Œë¬¸ì— zshë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ì´ êµ¬ë¬¸ì„ ë„£ì–´ì•¼ í•¨.

ì´í›„ ì´ ìƒì„±í•œ containerë¥¼ ì¢…ë£Œí•œ ë’¤ ë‹¤ì‹œ ì‹¤í–‰í•˜ë ¤ë©´ ì•„ë˜ì™€ ê°™ì´ commandë¥¼ ì…ë ¥í•˜ë©´ ëœë‹¤.

`docker exec -it [container id] zsh`

### containerì—ì„œ gdbë¥¼ processì— attachí•˜ëŠ” ë²• - tmux

ì•„ë˜ì™€ ê°™ì´ python í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•´ gdbë¥¼ processì— attachí•˜ë ¤ í•œë‹¤ê³  í•˜ì.

```python
from pwn import *

p = process("./asdf")
gdb.attach(p)
#...
```

ê·¸ëƒ¥ ìœ„ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ë©´ â€˜terminal is not setâ€™ì´ë¼ëŠ” errorê°€ ëœ¨ë©´ì„œ gdbê°€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ tmuxë¥¼ ì„¤ì¹˜í•œë‹¤.

[https://hbase.tistory.com/200](https://hbase.tistory.com/200)

tmuxë¥¼ ì„¤ì¹˜í•œ ë’¤ `tmux` ì»¤ë§¨ë“œë¥¼ ì…ë ¥í•œ ë’¤ gdbë¥¼ ì‹¤í–‰í•˜ë©´ ì˜ ì‹¤í–‰ë¨.

tmuxì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **ë§ˆìš°ìŠ¤**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ”ë°, `Ctrl + b + [`ë¥¼ ëˆ„ë¥´ë©´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ê³  í•˜ì§€ë§Œ ë‚´ ì»´í“¨í„°ì—ì„œëŠ” ë˜ì§€ ì•Šì•˜ë‹¤â€¦ `Ctrl + b`ë¥¼ ëˆ„ë¥´ê³  `:set -g mouse on`ì„ ì…ë ¥í•˜ë‹ˆ ë§ˆìš°ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆë‹¤.