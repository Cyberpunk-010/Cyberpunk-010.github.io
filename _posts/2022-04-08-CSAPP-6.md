---
title:  "CS:APP Chapter 6 Summary üìù"
excerpt: "Chatper 6 - The Memory Hierarchy"
toc: true
classes: wide

categories:
  - CSAPP

---
Recently, I've been studying CS:APP - I'm posting my own summary of chapter 6 that I wrote up using [Notion](https://cw00h.notion.site/CS-APP-6d3c5c01e6e1456ca51f594a80b5c1f0).

<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Chapter 6 : The Memory Hierarchy</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */

.Notion a,
.Notion a.visited {
	color: inherit;
	text-decoration: underline;
}

.Notion strong {
    font-weight: 600;
}

.Notion .pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

.Notion h1,
.Notion h2,
.Notion h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
    display: flex;
}

.Notion .page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

.Notion h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

.Notion h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

.Notion h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.Notion .source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.Notion .callout {
	border-radius: 3px;
	padding: 1rem;
}

.Notion figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

.Notion figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

.Notion mark {
	background-color: transparent;
}

.Notion .indented {
	padding-left: 1.5em;
}

.Notion hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

.Notion img {
	max-width: 100%;
}

@media only print {
	.Notion img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.Notion .collection-content {
	font-size: 0.875rem;
}

.Notion .column-list {
	display: flex;
	justify-content: space-between;
}

.Notion .column {
	padding: 0 1em;
}

.Notion .column:first-child {
	padding-left: 0;
}

.Notion .column:last-child {
	padding-right: 0;
}

.Notion .table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.Notion .table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.Notion .table_of_contents-indent-2 {
	margin-left: 3rem;
}

.Notion .table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.Notion .table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

.Notion table,
.Notion th,
.Notion td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

.Notion table {
	border-left: none;
	border-right: none;
}

.Notion th,
.Notion td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

.Notion th {
	color: rgba(55, 53, 47, 0.6);
}

.Notion ol,
.Notion ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

.Notion li > ol:first-child,
.Notion li > ul:first-child {
	margin-block-start: 0.6em;
}

.Notion ul > li {
	list-style: disc;
}

.Notion ul.to-do-list {
	text-indent: -1.7em;
}

.Notion ul.to-do-list > li {
	list-style: none;
}

.Notion .to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

.Notion ul.toggle > li {
	list-style: none;
}

.Notion ul {
	padding-inline-start: 1.7em;
}

.Notion ul > li {
	padding-left: 0.1em;
}

.Notion ol {
	padding-inline-start: 1.6em;
}

.Notion ol > li {
	padding-left: 0.2em;
}

.Notion .mono ol {
	padding-inline-start: 2em;
}

.Notion .mono ol > li {
	text-indent: -0.4em;
}

.Notion .toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.Notion .toggle > li > details {
	padding-left: 1.7em;
}

.Notion .toggle > li > details > summary {
	margin-left: -1.1em;
}

.Notion .selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.Notion .collection-title {
	display: inline-block;
	margin-right: 1em;
}

.Notion .simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.Notion .simple-table td {
	height: 29px;
	min-width: 120px;
}

.Notion .simple-table th {
	height: 29px;
	min-width: 120px;
}

.Notion .simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.Notion .simple-table-header {
	font-weight: 500;
}

.Notion time {
	opacity: 0.5;
}

.Notion .icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

.Notion img.icon {
	border-radius: 3px;
}

.Notion .user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.Notion .user-icon-inner {
	font-size: 0.8em;
}

.Notion .text-icon {
	border: 1px solid #000;
	text-align: center;
}

.Notion .page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.Notion .page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.Notion .page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.Notion .page-header-icon img {
	border-radius: 3px;
}

.Notion .link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

.Notion p > .user {
	opacity: 0.5;
}

.Notion td > .user,
.Notion td > time {
	white-space: nowrap;
}

.Notion input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

.Notion p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.Notion .image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.Notion .code,
.Notion code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

.Notion code {
	color: #eb5757;
}

.Notion .code {
	padding: 1.5em 1em;
}

.Notion .code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.Notion .code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

.Notion blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.Notion .bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.Notion .bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.Notion .bookmark-text {
	display: flex;
	flex-direction: column;
}

.Notion .bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.Notion .bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.Notion .bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.Notion .bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="82582472-0b9a-4406-bf00-ff461d71a734" class="page sans Notion" style="width: 100%; padding: 0px;"><div class="page-body"><h2 id="abb5f3b0-95f6-4030-8177-f0d97d4e554c" class=""><details open=""><summary><mark class="highlight-blue">6.1</mark> Storage Technologies</summary></details></h2><div class="indented"><ul id="e757916a-6453-4651-a7b7-4bf3cd449b56" class="toggle"><li><details open=""><summary><strong>RAM</strong></summary><ul id="29ce2f31-a624-4071-be61-6a22918169b2" class="toggle"><li><details open=""><summary><strong>SRAM &amp; DRAM</strong></summary><ul id="99bdd416-50ba-4b5d-89f1-4ed021f70873" class="bulleted-list"><li style="list-style-type:disc"><strong>SRAM (Static RAM)</strong><p id="50eae74c-1a4a-442e-814e-1fedf33e209b" class="">SRAM stores each bit in a <strong>bistable memory cell</strong>, which is implemented with a <strong>six-transistor</strong> circuit.</p><p id="0a7c3b66-3633-43a6-b6fa-2e2f6ba04e8c" class="">SRAM memory cell will retain its value <strong>indefinitely</strong>, <strong>as long as it is kept powered</strong>.</p><p id="74a57e3d-d339-499a-991f-dbf25630665d" class="">Even when a <strong>disturbance</strong>, such as electrical noise, perturbs the voltages, the circuit will <strong>return to the stable value when the disturbance is removed</strong>. </p></li></ul><ul id="ef8bf291-2fbf-44b9-88a3-03db66d3c5b1" class="bulleted-list"><li style="list-style-type:disc"><strong>DRAM (Dyanmic RAM)</strong><p id="d967595c-d640-4faf-9cac-448c5f547ed6" class="">DRAM stores each bit as charge on a capacitor, each cell consisting of a capacitor and a single access transistor. ‚Üí DRAM storage can be made very dense.</p><p id="baeee313-cb20-4c76-a80e-c3a08ee88d03" class="">DRAM is very sensitive to any disturbance ‚Üí Exposure to light rays will cause the capacitor voltage to change.</p><p id="90ad832c-9514-4266-9b0f-b8f0d0f85ea0" class="">DRAM‚Äôs memory system must periodically refresh every bit of memory by reading it out and then rewriting it.</p></li></ul><ul id="268d6ddf-1bc7-4fac-9435-6a2ebd573ecf" class="bulleted-list"><li style="list-style-type:disc">SRAM vs DRAM<figure id="09a80cb8-83c2-4d6f-bc2f-1a6eb218554b" class="image"><a href="/assets/images/CSAPP-6/Untitled.png"><img style="width:577px" src="/assets/images/CSAPP-6/Untitled.png"/></a></figure><p id="2c0c4e0c-f945-4708-8a2b-d3ff314007e6" class="">
</p></li></ul></details></li></ul><ul id="9a5223f6-80a1-4ed4-9c78-5b9ebc098eca" class="toggle"><li><details open=""><summary><strong>Conventional DRAMs and Enhanced DRAMs</strong></summary><ul id="5b6a6d28-566d-4846-81a6-e3df58fc52fb" class="bulleted-list"><li style="list-style-type:disc"><strong>Conventional DRAMs</strong><figure id="e4d25dd7-45cd-477a-b641-1545a226c37d" class="image"><a href="/assets/images/CSAPP-6/Untitled%201.png"><img style="width:528px" src="/assets/images/CSAPP-6/Untitled%201.png"/></a></figure><p id="350dbf11-3f4d-4809-8820-3d9b54fda77d" class="">The cells in a DRAM chip are partitioned into <strong><em>d</em></strong><strong> supercells</strong>, each consisting of <strong><em>w</em></strong><strong> DRAM cells</strong> - <strong><em>d * w </em></strong><strong>DRAM</strong> stores a total of <em>dw</em> bits of information.</p><p id="444bd0e3-37cb-4e1a-8314-d30847bd7e70" class="">The supercells are organized as a <strong>rectangular array with </strong><strong><em>r </em></strong><strong>rows and </strong><strong><em>c </em></strong><strong>columns</strong>, where <em>rc = d. </em>Each supercells has an address of the form<strong> </strong><strong><em>(i, j)</em></strong><em>.</em></p><p id="702a7a1a-5025-4ddc-a3da-6fda0ff905bc" class="">Information flows in and out of the chip via external connectors called <strong>pins</strong>, each of which carries a 1-bit signal.  - <strong>data pins</strong> transfer data in or out of the chip, and <strong>addr pins</strong> carry row and column supercell addresses.</p><p id="1688b7f3-30a2-4934-89cf-bb2e67197887" class=""><strong>Memory controller</strong> transfer <em>w </em>bits at a time to and from each DRAM chip. </p><p id="3a4a1add-d9f0-4cb9-9f6a-9c2740736aa6" class="">To read the contents of supercell <em>(i, j), </em>the memory controller sends <em>i</em>, which is called a <strong>RAS (row access strobe) request</strong>, to the DRAM, followed by <em>j</em>, which is called a <strong>CAS (column access strobe) request</strong><em>. ‚Üí </em>DRAM responds by copying the <strong>entire contents of row </strong><strong><em>i</em></strong><strong> </strong>into an <strong>internal row buffer</strong>, then <strong>copying the </strong><strong><em>w</em></strong><strong> bits in supercell </strong><strong><em>(i, j)</em></strong><strong> from the row buffer</strong> and sending them to the memory controller.</p><p id="2fe92b0b-47b1-4334-8dec-1f5554aa3528" class="">Circuit designers organized DRAMs as two-dimensional arrays to <strong>reduce the number of address pins</strong> on the chip.</p></li></ul><ul id="0df512d5-c10a-46a2-a47e-422ec280161a" class="bulleted-list"><li style="list-style-type:disc">Memory Modules<figure id="de349800-f63f-4c58-a5d0-4841519875fe" class="image"><a href="/assets/images/CSAPP-6/Untitled%202.png"><img style="width:384px" src="/assets/images/CSAPP-6/Untitled%202.png"/></a></figure><p id="575bfca0-e729-4545-8a01-42b75ca6571c" class="">DRAM chips are packaged in <strong>memory modules</strong> that plug into expansion slots on the main system board.</p><p id="8b0e7740-71d8-48c7-9716-385da544149f" class="">The example module in figure stores a total of 64 MB using eight 64-Mbit 8M * 8 DRAM chips, numbered 0 to 7.</p><p id="60d6fe6a-d416-430c-ba2e-06717d3a3496" class="">Each <strong>64-bit word at byte address </strong><strong><em>A </em></strong><strong>in main memory</strong> is represented by the <strong>8 supercells whose corresponding supercell address is </strong><strong><em>(i, j)</em></strong>.</p><p id="7b6ec12a-4f69-4071-a825-e1aa5226a686" class="">To retrieve the word at memory address <em>A,</em> the memory controller <strong>converts </strong><strong><em>A</em></strong><strong> to a supercell address </strong><strong><em>(i, j)</em></strong><em> </em>and sends it to the memory module ‚Üí The memory module sends <em>i </em>and <em>j</em> to DRAM ‚Üí <strong>Each of DRAMs outputs 8-bit contents of its </strong><strong><em>(i, j)</em></strong><strong> supercell</strong>. ‚Üí <strong>Circuitry in the module collects these outputs</strong> and forms them into a 64-bit word, which it returns to the memory controller.</p><p id="2a059d99-367b-469d-9bc3-edac8e54387d" class=""><strong>Main memory</strong> can be aggregated by connecting multiple memory modules to the memory controller.</p></li></ul><ul id="2377aca2-0180-446c-9cf7-be2fa4948e5b" class="bulleted-list"><li style="list-style-type:disc">Enhanced DRAMs<ul id="eaa30f11-cd5c-4978-ad67-5a0b1ca5b498" class="bulleted-list"><li style="list-style-type:circle">Fast page mode DRAM (FPM DRAM) : allows consecutive accesses to the same row to be served directly from the row buffer.</li></ul><ul id="c7f6e133-ac88-4797-bf51-45fb687e68c8" class="bulleted-list"><li style="list-style-type:circle">Extended data out DRAM (EDO DRAM) : An enhanced form of FPM DRAM that allows the individaul CAS signals to be spaced closer together in time.</li></ul><ul id="9ab586e2-f8af-40f0-b7b2-0e5ac2da1cde" class="bulleted-list"><li style="list-style-type:circle">Synchronous DRAM (SDRAM) : uses the rising edges of the same external clock signal that drives the memory controller to communicate with the memory controller. ‚Üí can output the contents at a faster rate.</li></ul><ul id="ced7f5bb-c2f8-4ace-a194-f81a9e03ec2c" class="bulleted-list"><li style="list-style-type:circle">Double Data-Rate Synchronous DRAM (DDR SDRAM) : uses both clock edges as control signals.</li></ul><ul id="85163692-696f-4d71-a6e6-9e2b5a63f442" class="bulleted-list"><li style="list-style-type:circle">Video RAM (VRAM) : used in the frame buffers of graphics systems.</li></ul></li></ul></details></li></ul><ul id="8c3034c3-3650-4308-83c6-eeaa3e1c9c9d" class="toggle"><li><details open=""><summary><strong>Nonvolatile Memory</strong></summary><p id="5352bcf5-d987-4707-a93c-3f3266dcf490" class="">DRAMs and SRAMs are <strong>volatile </strong>- they lose their information if the supply voltage is turned off. ‚Üî <strong>Nonvolatile memories</strong> retain their information even when they are powered off.</p><p id="48956b21-51dd-44a3-b5ec-de1c510bac58" class="">Nonvolatile memories are referred to collectively as <strong>read-only memories</strong>(<strong>ROMs</strong>).</p><ul id="ae2dc33b-c00e-4760-9290-bfe471f74382" class="bulleted-list"><li style="list-style-type:disc"><strong>Programmable ROM</strong> (<strong>PROM</strong>) : can be programmed exactly <strong>once</strong>.</li></ul><ul id="e035fdc8-8d0f-43ba-b120-16d06789c0dc" class="bulleted-list"><li style="list-style-type:disc"><strong>Erasable programmable ROM (EPROM</strong>)<p id="6763b660-d670-4060-81df-9610064f3d7e" class="">EPROM has a transparent window that permits light to reach the storage cells - EPROM cells are cleared to zeros by shining ultraviolet light.</p><p id="bd00f46d-73b1-4263-9ae6-1041830816d1" class="">EPROM can be programmed by using a special device to write ones.</p><p id="9802002b-8f76-48d7-91f9-947857446e2e" class="">EPROM can be erased and reprogrammed on the order of <strong>1,000 times</strong>.</p></li></ul><ul id="726edced-9347-4324-91cb-3620f621e7c4" class="bulleted-list"><li style="list-style-type:disc"><strong>Electrically erasable PROM (EEPROM)</strong><p id="6b42273a-aecd-4035-b80c-0c238423dd72" class="">EEPROM is similar to EPROM, but doesn‚Äôt need a physically separate programming device - can be <strong>reprogrammed in-place on circuit cards</strong>.</p><p id="5586ef95-fe7a-452a-aabb-4db091f0647e" class="">EEPROM can be reprogrammed on the order of <strong>100,000 times</strong>.</p></li></ul><ul id="0bef3912-ad30-4868-9bb9-03bcc47706f1" class="bulleted-list"><li style="list-style-type:disc"><strong>Flash memory</strong><p id="ec1e07c8-4251-497c-ad3b-aad32d2a21de" class="">Flash memory is a nonvolatile memory based on EEPROMs.</p><p id="ff36784c-ab3d-4237-8bf5-9bddb81c836e" class=""><strong>Solid state disk (SSD) </strong>is a new form of flash-based disk drive.</p></li></ul><p id="f2d022a2-d857-40ec-a58c-69d0ea6bcfa7" class="">Programs stored in ROM devices are called firmware. When a computer system is powered up, it runs firmware stored in ROM. </p><p id="e76ce727-9d0c-4bab-94ab-8766c7836689" class="">Some systems provide a small set of primitive input and output functions in firmware. (<em>example : PC‚Äôs BIOS (basic input/output system) routines)</em></p></details></li></ul><ul id="bef7963e-9989-4fea-b3b5-2e281178f77f" class="toggle"><li><details open=""><summary><strong>Accessing Main Memory</strong></summary><p id="b9611e0a-8992-469c-916c-9946b9ee519f" class=""><strong>Bus transaction</strong> is a series of steps required to transfer data between the CPU and memory. - <strong>read transaction</strong> : main memory ‚Üí CPU, <strong>write transaction</strong> : CPU ‚Üí main memory.</p><figure id="f93a3ffe-7ae8-4d65-b981-122e386637b8" class="image"><a href="/assets/images/CSAPP-6/Untitled%203.png"><img style="width:336px" src="/assets/images/CSAPP-6/Untitled%203.png"/></a></figure><p id="33823937-79f1-481f-b522-5b72cfc4a173" class="">Main components of computer system are the <strong>CPU chip</strong>, <strong>I/O bridge</strong>, and the <strong>DRAM memory modules</strong> that make up main memory.</p><p id="bc044fcf-31e2-4309-bebc-bf89c00a8923" class="">These components are connected by a <strong>system bus</strong> that connects the <strong>CPU to the I/O bridge</strong>, and a <strong>memory bus</strong> that connects the <strong>I/O bus to the main memory</strong>.</p><p id="19e6cc46-bbc3-436e-8535-d7cad4f31338" class=""><strong>I/O bridge</strong> translates the electrical signals of the system bus into the electrical signals of the memory bus.</p><ul id="4d9c4ae6-f3fb-49aa-9949-d7b6398c52de" class="bulleted-list"><li style="list-style-type:disc"><strong>Read transaction</strong> : <code>movq A, %rax</code></li></ul><p id="8163cdb3-14b2-4eb0-9218-c1b79c787c9a" class="">The bus interface, circuitry on the CPU chip, initiates a read transaction when CPU performs a load operation :</p><ol type="1" id="33268e7e-dc81-42f0-b235-f90da3ea97d6" class="numbered-list" start="1"><li>CPU places the address <code>A</code> on the <strong>system bus</strong>. <strong>I/O bridge</strong> passes the signal along to the <strong>memory bus</strong>.</li></ol><ol type="1" id="7ae0f275-0254-4b61-9ef9-149a03989d1d" class="numbered-list" start="2"><li>Main memory senses the address signal on the memory bus, reads the address from the memory bus, <strong>fetches the data from the DRAM</strong>, and <strong>writes the data to the memory bus</strong>. <strong>I/O bridge </strong>translates the memory bus signal into a system bus signal and <strong>passes it along to the system bus</strong>.</li></ol><ol type="1" id="95b7e3ee-ba51-4832-8457-8ace34eb4bf4" class="numbered-list" start="3"><li><strong>CPU </strong>senses the data on system bus, <strong>reads the data from the bus</strong>, and <strong>copies the data to </strong><strong><code>%rax</code></strong>.</li></ol><ul id="7b210e10-e554-40d1-87ee-e0cce4b6c870" class="bulleted-list"><li style="list-style-type:disc"><strong>Write transaction</strong> : <code>movq %rax, A</code></li></ul><ol type="1" id="dcda3773-6d5f-4943-bc21-8267d87634e2" class="numbered-list" start="1"><li>CPU places the <strong>address </strong><strong><code>A</code></strong><strong> </strong>on the <strong>system bus</strong>. The <strong>memory reads the address</strong> from the memory bus.</li></ol><ol type="1" id="c025ffeb-35e5-449c-a0b2-b88a974840b5" class="numbered-list" start="2"><li>CPU <strong>copies the data in </strong><strong><code>%rax</code></strong><strong> to the system bus</strong>.</li></ol><ol type="1" id="955a7b4f-65e1-472f-86c2-ad2bcbe30e45" class="numbered-list" start="3"><li>The <strong>main memory reads the data</strong> from the memory bus and <strong>stores the bits in the DRAM</strong>.</li></ol><p id="40f28fd8-a292-45b1-af36-1660bfe00663" class="">
</p></details></li></ul><p id="cbe5a2e1-3e54-4383-ad07-caf9c98725fd" class="">
</p></details></li></ul><ul id="8f11136c-5565-4559-b318-d99e1206a88c" class="toggle"><li><details open=""><summary><strong>Disk Storage</strong></summary><p id="eae644c2-498f-4bf9-8f00-81dafa2389d8" class="">Disks are workhorse storage devices that hold enormous amounts of data, as opposed to a RAM-based memory.</p><ul id="e4f13278-7fcf-4724-a861-69fe7cc0592a" class="toggle"><li><details open=""><summary><strong>Disk Geometry</strong></summary><figure id="b4467c75-8329-4978-aec6-b7424696e43f" class="image"><a href="/assets/images/CSAPP-6/Untitled%204.png"><img style="width:480px" src="/assets/images/CSAPP-6/Untitled%204.png"/></a></figure><p id="e402298a-0c81-40f0-aa0e-bc5bb051aad9" class="">Disks are constructed from <strong>platters</strong>. Each platter consists of two <strong>surfaces </strong>that are coated with magnetic recording material.</p><p id="66e02657-0424-409d-ad9e-d71387e58326" class="">Each surface consists of a collection of concentric rings called <strong>tracks</strong>, each of which is partitioned into a collection of <strong>sectors</strong>. <strong>Each sector contains an equal number of data bits</strong>. Sectors are separated by <strong>gaps</strong>.</p><p id="07e527ba-44ae-4bce-b3c6-5b2b2faf82d9" class="">A disk consists of one or more platters stacked on top of each other - <strong>Cylinder </strong>is the <strong>collection of tracks</strong> on all the surfaces that are equidistant from the center of the spindle. </p><p id="d4b695b2-5296-4ce8-9f4b-599f636d934e" class="">(<em>example : if a drive has 3 platters and 6 surfaces, then cylinder k is the collection of the six instances of track k.)</em></p><p id="9204a719-c736-4fac-bc93-9387ffa3323f" class="">
</p></details></li></ul><ul id="2d387530-ad7a-4755-9a0c-89cf05240680" class="toggle"><li><details open=""><summary><strong>Disk Capacity</strong></summary><ul id="800dff8e-247a-4fd0-aa8e-07805a440675" class="bulleted-list"><li style="list-style-type:disc"><strong>capacity </strong>: the maximum number of bits that can be recorded by a disk</li></ul><ul id="a90a671b-204e-47c6-9ee1-e51b22315b36" class="bulleted-list"><li style="list-style-type:disc">The factors that determine disk capacity<ul id="75aa149a-2927-4138-80ac-ee2ea483b460" class="bulleted-list"><li style="list-style-type:circle"><strong>Recording density</strong> (<em>bits/in</em>) : The <strong>number of bits</strong> that can be squeezed into <strong>1 inch segment of a track</strong>.</li></ul><ul id="1477a570-3d5d-47a0-803f-1cad0b52453d" class="bulleted-list"><li style="list-style-type:circle"><strong>Track density</strong> (<em>tracks/in</em>) : The<strong> number of tracks </strong>that can be squeezed into a <strong>1 inch segment of the radius</strong> extending from the center of the platter.</li></ul><ul id="d7025802-751a-4f62-938c-e1e7869c123e" class="bulleted-list"><li style="list-style-type:circle"><strong>Areal density</strong> (<style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>i</mi><mi>t</mi><mi>s</mi><mi mathvariant="normal">/</mi><mi>i</mi><msup><mi>n</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">bits/in^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathnormal">bi</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mord">/</span><span class="mord mathnormal">i</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span>Ôªø</span></span>) : The <strong>product </strong>of the <strong>recording density</strong> and the <strong>track density</strong>.</li></ul></li></ul><ul id="39f1fbb7-f814-48b9-b350-91e7c78d223a" class="bulleted-list"><li style="list-style-type:disc"><strong>Multiple zone recording</strong></li></ul><figure id="3f6b11ab-3023-47bd-aa60-229959c4d6dd" class="image"><a href="/assets/images/CSAPP-6/Untitled%205.png"><img style="width:336px" src="/assets/images/CSAPP-6/Untitled%205.png"/></a></figure><p id="06c5f157-df31-4c35-9f59-2f8e31755b6f" class="">Modern high-capacity disks use <strong>multiple zone recording</strong>, where the set of cylinders is partitioned into disjoint subsets known as recording zones.</p><p id="519cb714-7ea2-4c12-8cf1-64d03fd484d0" class=""><strong>Each track</strong> in each cylinder in a zone <strong>has the</strong> <strong>same number of sectors</strong>, which is determined by the number of sectors that can be packed into the innermost track of the zone.</p><ul id="4500c696-5287-4689-98eb-234520969703" class="bulleted-list"><li style="list-style-type:disc"><strong>Capacity of a disk</strong></li></ul><p id="1ca7d731-0a66-4755-a4e5-f752bfe02c0e" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>a</mi><mi>p</mi><mi>a</mi><mi>c</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>=</mo><mfrac><mrow><mi mathvariant="normal">#</mi><mtext>¬†</mtext><mi>b</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>s</mi></mrow><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow></mfrac><mo>√ó</mo><mfrac><mrow><mi>a</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi><mtext>¬†</mtext><mi mathvariant="normal">#</mi><mtext>¬†</mtext><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>s</mi></mrow><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>k</mi></mrow></mfrac><mo>√ó</mo><mfrac><mrow><mi mathvariant="normal">#</mi><mtext>¬†</mtext><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>k</mi><mi>s</mi></mrow><mrow><mi>s</mi><mi>u</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi></mrow></mfrac><mo>√ó</mo><mfrac><mrow><mi mathvariant="normal">#</mi><mtext>¬†</mtext><mi>s</mi><mi>u</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>s</mi></mrow><mrow><mi>p</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow></mfrac><mo>√ó</mo><mfrac><mrow><mi mathvariant="normal">#</mi><mtext>¬†</mtext><mi>p</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi></mrow><mrow><mi>d</mi><mi>i</mi><mi>s</mi><mi>k</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">Capacity=\frac{\#\ bytes}{sector}\times\frac{average\  \#\ sectors}{track}\times\frac{\#\ tracks}{surface}\times\frac{\#\ surfaces}{platter}\times\frac{\#\ platters}{disk}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.277216em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322159999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">sec</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">or</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">#</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">es</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.277216em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322159999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">er</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">e</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mtight">#</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">sec</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ors</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.4133239999999998em;vertical-align:-0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322159999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">ce</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">#</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.481108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.4133239999999998em;vertical-align:-0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322159999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">tt</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">er</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">#</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">ces</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.481108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.277216em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322159999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">#</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">tt</span><span class="mord mathnormal mtight">ers</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><span>Ôªø</span></span></p><p id="68c33fc4-4038-4731-b0b9-aba0a3b3464a" class="">
</p></details></li></ul><ul id="81b53962-b777-4aa2-931a-7e14506369b0" class="toggle"><li><details open=""><summary><strong>Disk Operation</strong></summary><ul id="165812a5-5351-45e4-bc37-090e4905e53b" class="bulleted-list"><li style="list-style-type:disc"><strong>How disks read and write data</strong></li></ul><ol type="1" id="b8d51067-e0b5-4be3-ab6b-17c21311a58b" class="numbered-list" start="1"><li>Disks read and write bits using a <strong>read/write head</strong> connected to the end of an actuator arm. The drive <strong>position the head over the track</strong> on the surface by moving the arm. - This mechanical motion is known as a <strong>seek</strong>.</li></ol><ol type="1" id="46c4c9d6-2b74-4d61-8609-43f79812f3a4" class="numbered-list" start="2"><li>As each bit on the track passes underneath, <strong>the head can sense the data or alter the data</strong>.</li></ol><ul id="75ed9fbf-9d56-4432-b1f8-a88b759dc6d6" class="bulleted-list"><li style="list-style-type:disc"><strong>Access time</strong><p id="af1401f9-1334-458a-b7dd-7fcc1f605a6f" class="">The access time for a sector has 3 main components :  <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>a</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi></mrow></msub><mo>=</mo><msub><mi>T</mi><mrow><mi>a</mi><mi>v</mi><mi>g</mi><mtext>¬†</mtext><mi>s</mi><mi>e</mi><mi>e</mi><mi>k</mi></mrow></msub><mo>+</mo><msub><mi>T</mi><mrow><mi>a</mi><mi>v</mi><mi>g</mi><mtext>¬†</mtext><mi>r</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>+</mo><msub><mi>T</mi><mrow><mi>a</mi><mi>v</mi><mi>g</mi><mtext>¬†</mtext><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>f</mi><mi>e</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{access}=T_{avg\ seek}+T_{avg\ rotation}+T_{avg\ transfer}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">ccess</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">vg</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">see</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">vg</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">ro</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">vg</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">an</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">er</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span><span>Ôªø</span></span></p><ul id="bf6ce87f-1ea6-47d5-b70f-f401f816ccea" class="bulleted-list"><li style="list-style-type:circle"><strong>Seek time</strong> <p id="427149a3-b888-41b1-9546-4b8f7cb511d9" class="">The time required to <strong>move the arm</strong> to position the head over the track that contains the target sector.</p><p id="f0ec8e56-fca0-4fce-99d6-56884943d5ff" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>a</mi><mi>v</mi><mi>g</mi><mtext>¬†</mtext><mi>s</mi><mi>e</mi><mi>e</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{avg\ seek}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">vg</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">see</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span><span>Ôªø</span></span> = 3~9ms</p></li></ul><ul id="b3ce7760-742d-4434-bbb4-bb44a4323340" class="bulleted-list"><li style="list-style-type:circle"> <strong>Rotational latency</strong><p id="2450c003-b4a4-4917-bbf7-e8fe171bbecc" class="">The time that drive <strong>waits for the first bit of the target sector</strong> to pass under the head.  </p><p id="5a1890b5-5122-414d-925a-1bef53e747d9" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mtext>¬†</mtext><mi>r</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mi>R</mi><mi>P</mi><mi>M</mi></mrow></mfrac><mo>√ó</mo><mfrac><mrow><mn>60</mn><mtext>¬†</mtext><mi>s</mi><mi>e</mi><mi>c</mi><mi>s</mi></mrow><mrow><mn>1</mn><mtext>¬†</mtext><mi>m</mi><mi>i</mi><mi>n</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">T_{max\ rotation} = \frac{1}{RPM}\times\frac{60\ secs}{1\ min}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">x</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">ro</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">RPM</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">min</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">60</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">secs</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><span>Ôªø</span></span>, <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>a</mi><mi>v</mi><mi>g</mi><mtext>¬†</mtext><mi>r</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>√ó</mo><msub><mi>T</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mtext>¬†</mtext><mi>r</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{avg\ rotation} = \frac{1}{2}\times T_{max\ rotation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">vg</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">ro</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">x</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">ro</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>Ôªø</span></span></p></li></ul><ul id="d42fa1a5-1b56-4728-8add-52f674d30da1" class="bulleted-list"><li style="list-style-type:circle"><strong>Transfer time</strong><p id="1391f485-90a9-44f3-815e-5e3d9984c19b" class="">The time for drive to <strong>read or write the contents of the sector</strong>.</p><p id="17f38482-502a-44d2-9362-c97b523ceff7" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>a</mi><mi>v</mi><mi>g</mi><mtext>¬†</mtext><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>f</mi><mi>e</mi><mi>r</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mi>R</mi><mi>P</mi><mi>M</mi></mrow></mfrac><mo>√ó</mo><mfrac><mn>1</mn><mrow><mo stretchy="false">(</mo><mi>a</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi><mtext>¬†</mtext><mi mathvariant="normal">#</mi><mtext>¬†</mtext><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>s</mi><mi mathvariant="normal">/</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>k</mi><mo stretchy="false">)</mo></mrow></mfrac><mo>√ó</mo><mfrac><mrow><mn>60</mn><mtext>¬†</mtext><mi>s</mi><mi>e</mi><mi>c</mi><mi>s</mi></mrow><mrow><mn>1</mn><mtext>¬†</mtext><mi>m</mi><mi>i</mi><mi>n</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">T_{avg\ transfer}=\frac{1}{RPM}\times\frac{1}{(average\ \#\ sectors/track)}\times\frac{60\ secs}{1\ min}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">vg</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">an</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">er</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">RPM</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.365108em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">er</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">e</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mtight">#</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">sec</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ors</span><span class="mord mtight">/</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">min</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">60</span><span class="mspace mtight"><span class="mtight">¬†</span></span><span class="mord mathnormal mtight">secs</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><span>Ôªø</span></span></p></li></ul></li></ul><ul id="7c392a45-05ba-49ca-b135-8ec5d8c3181f" class="bulleted-list"><li style="list-style-type:disc"><strong>Important points</strong><ul id="8fa848a7-d9e2-45a7-a30b-13c327b8a20c" class="bulleted-list"><li style="list-style-type:circle">Access time is typically dominated by the <strong>seek time</strong> and the <strong>rotational latency</strong>.</li></ul><ul id="2beca3d5-4d1c-436a-856d-bf9c53f5a1d8" class="bulleted-list"><li style="list-style-type:circle">The disk access time is about 40,000 times greater than SRAM and about 2,500 times greater than DRAM for the example in the book.</li></ul></li></ul></details></li></ul><ul id="a154cbe8-cc1b-479b-b655-3ba965080ccd" class="toggle"><li><details open=""><summary><strong>Logical Disk Blocks</strong></summary><p id="f33624b2-5c69-4664-be07-aa34c44575a6" class="">Modern disks present a simpler view of disk‚Äôs geometry as <strong>a sequence of </strong><strong><em>B</em></strong><strong> sector-size</strong> <strong>logical blocks</strong>, numbered 0, 1, ..., <em>B-1.</em></p><p id="b70a5618-255e-4f35-81ec-892eabe52bc4" class=""><strong>Disk controller</strong>, a small hardware/firmware device in the disk package, maintains the <strong>mapping between logical block numbers and actual disk sectors</strong>.</p><ul id="d8ca2aaf-3e83-42cc-8c6a-96229a20bfa8" class="bulleted-list"><li style="list-style-type:disc"><strong>How OS reads a disk sector into main memory</strong></li></ul><ol type="1" id="6cc10aa9-a627-4266-b80d-3593b57639ce" class="numbered-list" start="1"><li><strong>OS asks the disk controller</strong> to read a particular <strong>logical block number</strong>.</li></ol><ol type="1" id="47a2cfea-afc6-4f00-811e-f265468a0265" class="numbered-list" start="2"><li>Firmware on the controller performs a <strong>fast table lookup</strong> that translates the logical block number into <strong>a </strong><strong><em>(surface, track, sector)</em></strong><strong> triple</strong>.</li></ol><ol type="1" id="1d5ec678-6cba-423f-b2a8-ab5a9dd6d22e" class="numbered-list" start="3"><li>Hardware on the controller interprets this triple to <strong>move the heads to the appropriate cylinder</strong>.</li></ol><ol type="1" id="587147dc-cb41-4bf7-b9a4-7b0fda3fbfa3" class="numbered-list" start="4"><li>The head reads in the data, and the <strong>bits sensed are gathered up into a small memory buffer on the controller</strong>, then are <strong>copied into main memory</strong>. </li></ol></details></li></ul><ul id="8d82099c-34a5-43e3-b6a6-d0feeb433fd9" class="toggle"><li><details open=""><summary><strong>Connecting I/O Devices</strong></summary><figure id="fe8d3c64-c7d2-4445-b132-40e1e62aeb52" class="image"><a href="/assets/images/CSAPP-6/Untitled%206.png"><img style="width:336px" src="/assets/images/CSAPP-6/Untitled%206.png"/></a></figure><p id="47168fef-d98e-47da-9b9b-f857be9522f4" class="">I/O devices are connected to the CPU and main memory using an <strong>I/O bus</strong>.</p><p id="8763642f-fdf7-416a-8450-b9c40bd2aa4d" class="">I/O bus is <strong>slower </strong>than the system and memory buses, but it <strong>can accommodate a wide variety </strong>of third-party I/O devices.</p><p id="6081078f-f993-44d8-bcdc-4e4c397b8b92" class="">In a system with <strong>memory-mapped I/O</strong>, a <strong>block of addresses</strong> in the address space is <strong>reserved for communicating with I/O devices</strong>. Each of these addresses is known as an <strong>I/O port</strong>. Each device is associated with one or more ports.</p><ul id="63e1f7f9-08f3-41bd-b5d4-2590076200a3" class="bulleted-list"><li style="list-style-type:disc"><strong>How CPU reads a disk sector</strong></li></ul><ol type="1" id="8b2f19ab-c052-41e4-8974-59714ffac3de" class="numbered-list" start="1"><li>CPU can initiate a disk read by executing<strong> three store instructions</strong> to the disk controller‚Äôs port :<ul id="6f1c8895-9a49-4185-bb74-f795329b03a0" class="bulleted-list"><li style="list-style-type:disc">tells the disk to <strong>initiate a read</strong>, along with other parameters. (i.e. whether to interrupt the CPU when the read is finished)</li></ul><ul id="c402ce82-93ab-4ad3-80d6-d1b3102588e1" class="bulleted-list"><li style="list-style-type:disc">indicates the <strong>logical block number</strong> that should be read.</li></ul><ul id="d95900a9-39e4-4106-b784-d1e8f8ff2855" class="bulleted-list"><li style="list-style-type:disc">indicates the <strong>main memory address</strong> where the contents of the disk sector should be stored.</li></ul></li></ol><ol type="1" id="d70f3ff5-51ae-4575-b5ac-b4bd0f0b7fb5" class="numbered-list" start="2"><li>After the request, <strong>CPU </strong>will typically <strong>do other work</strong> while the disk is performing the read to minimize the waste of time.</li></ol><ol type="1" id="776aadf0-f313-4ed3-a09f-3e3e7e5541c7" class="numbered-list" start="3"><li>After the request, <strong>disk controller</strong> will read the contents of the sector, and <strong>transfer the contents directly to main memory</strong>, without any intervention from the CPU. ‚Üí <strong>Direct memory access (DMA)</strong></li></ol><ol type="1" id="3f2a0e3b-444d-497d-b270-51df4f57d280" class="numbered-list" start="4"><li>After the DMA transfer is complete, the disk controller <strong>sends an interrupt signal to the CPU</strong>.</li></ol><ol type="1" id="c03cc25e-d1a7-4042-90d5-6d39dbcfc510" class="numbered-list" start="5"><li>CPU stops what it is currently working on and jump to an <strong>OS routine</strong> that <strong>records the fact that the I/O has finished</strong> and then returns control to the point where the CPU was interrupted.</li></ol></details></li></ul><ul id="9f0d0394-c79f-4b7a-a113-3cb9f8d0625a" class="toggle"><li><details open=""><summary><strong>Solid State Disks (SSD)</strong></summary><p id="acc6fbed-5499-4214-8cbb-dd6d23160956" class=""><strong>Solid state disks (SSD) </strong>is a storage technology <strong>based on flash memory</strong> that behaves like any other disk.</p><figure id="1776c200-b0a3-4820-a9e7-3a787b7f9481" class="image"><a href="/assets/images/CSAPP-6/Untitled%207.png"><img style="width:576px" src="/assets/images/CSAPP-6/Untitled%207.png"/></a></figure><ul id="080b0160-505f-4f07-ba3b-afd94598524a" class="bulleted-list"><li style="list-style-type:disc"><strong>SSD‚Äôs component</strong><ul id="5810ae93-3ac1-4675-9506-fce42de7a7fa" class="bulleted-list"><li style="list-style-type:circle">one or more <strong>flash memory chips</strong> <p id="3ae329c8-0adf-4099-bc01-e56f6119391c" class="">Flash memory chips are similar with the mechanical drive in a conventional rotating disk.</p><p id="fa7c378a-7bd3-4fd4-a13e-984b54f47949" class="">Flash memory consists of a sequence of <strong><em>B</em></strong><strong> blocks</strong>, where <strong>each block consists of </strong><strong><em>P </em></strong><strong>pages</strong>.</p></li></ul><ul id="7469dca5-3c20-444d-b77d-053fda911e94" class="bulleted-list"><li style="list-style-type:circle"><strong>flash translation layer</strong> <strong><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>‚âà</mo></mrow><annotation encoding="application/x-tex">\approx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.48312em;vertical-align:0em;"></span><span class="mrel">‚âà</span></span></span></span></span><span>Ôªø</span></span></strong><strong> disk controller</strong><p id="a36b3cb8-05d9-4bcc-ab42-4f7e0b17597d" class="">Flash translation layer <strong>translates requests for logical blocks into accesses of the physical device</strong>.</p></li></ul></li></ul><ul id="b8e13dcd-e0ea-4e83-96dd-3eb7ad39f492" class="bulleted-list"><li style="list-style-type:disc"><strong>Writing of SSD</strong></li></ul><p id="8afa4f1e-fb24-41af-86f2-f554e71dc076" class="">SSD‚Äôs data are read and written <strong>in units of pages</strong>.</p><p id="e736e689-eb47-4620-87e3-60cd547b7162" class="">A page can be written <strong>only after the block to which it belongs has been erased</strong>. Once a block is erased, each page in the block can be written once with no further erasing.</p><p id="3cd7edce-0089-47d4-86b7-ff21e4a63ea8" class="">If a write operation attempts to modify a page <em>p</em>, then <strong>any pages in the same block with useful data must be copied</strong> to a new block before erasure.</p><p id="4e0254d7-1ff6-4f9f-ab90-93be6cd823b9" class="">‚áí Random writing is <strong>slower </strong>than random reading.</p><ul id="f706dee3-a163-4d2c-957f-86e8201e3199" class="bulleted-list"><li style="list-style-type:disc"><strong>Advantages of SSD over rotating disks</strong><ul id="40411c1c-4f55-47f9-a126-650e22b694fc" class="bulleted-list"><li style="list-style-type:circle">SSDs have much <strong>faster </strong>random access times.</li></ul><ul id="01f5e06b-dbb0-4b64-8b3c-3908018f9969" class="bulleted-list"><li style="list-style-type:circle">SSDs use <strong>less power</strong>.</li></ul><ul id="f23d9cc6-ca07-41ae-af70-79f6123ce99f" class="bulleted-list"><li style="list-style-type:circle">SSDs are more <strong>rugged</strong>.</li></ul></li></ul><ul id="33cd24a0-2fd4-4aa1-8ead-47122fe8ef70" class="bulleted-list"><li style="list-style-type:disc"><strong>Disadvantages of SSD</strong><ul id="5d4b3fe0-b16c-4f33-a41b-fe9e7715606f" class="bulleted-list"><li style="list-style-type:circle">SSDs have potential to <strong>wear out</strong> - A block wears out after roughly 100,000 repeated writes.<p id="ae920036-548e-4d1a-b09f-c311cc22e15a" class="">‚áí <strong>Wear-leveling logic</strong> in the flash translation layer attempts to maximize the lifetime of each block by <strong>spreading erasures across the blocks</strong>.</p></li></ul><ul id="9bb70934-23db-49a8-8c10-5ed8da89af6a" class="bulleted-list"><li style="list-style-type:circle">SSDs are about 30 times more <strong>expensive </strong>per byte than rotating disks.</li></ul></li></ul></details></li></ul><ul id="97a05eeb-a0e3-453c-b22a-c58b04f375d7" class="toggle"><li><details open=""><summary><strong>Storage Technology Trends</strong></summary><ul id="c446e497-1d1b-42a1-9941-5b1fe106134d" class="bulleted-list"><li style="list-style-type:disc">Different storage technologies have different price and performance trade-offs. - <strong>Fast storage</strong> is always <strong>more expensive</strong> than slower storage.</li></ul><ul id="f61a6002-cc28-4a00-a054-71b998dc8c01" class="bulleted-list"><li style="list-style-type:disc">The price and performance properties of different storage technologies are changing at dramatically different rates.</li></ul><ul id="3d40f07d-ffbc-40e2-986f-ac7d4bdf981b" class="bulleted-list"><li style="list-style-type:disc">DRAM and disk performance are lagging behind CPU performance ‚Üí Modern computers make heavy use of <strong>SRAM-based caches</strong> to try to <strong>bridge the processor-memory gap</strong>.</li></ul><p id="f59da81e-3383-4ad6-9cc8-733599616cf3" class="">
</p></details></li></ul></details></li></ul></div><h2 id="7c27d85f-2cb9-4922-bdeb-032c9ed510f6" class=""><details open=""><summary><mark class="highlight-blue">6.2</mark> Locality</summary></details></h2><div class="indented"><ul id="c8a1cf83-e23f-4245-87d8-d045c42f480f" class="toggle"><li><details open=""><summary><strong>Meaning of Locality</strong></summary><p id="66ef0b3c-8fa7-43c6-9315-a3df643c804a" class="">Programs with good <strong>locality </strong>tend to reference data items that are <strong>near other recently referenced data items</strong> or that <strong>were recently referenced themselves</strong>.</p><p id="85d0adf6-4fa5-4939-90f0-721c064a3f7e" class="">In a program of good <strong>temporal locality</strong>, a memory location referenced once is likely to <strong>be referenced again multiple times</strong> in the near future.</p><p id="93a74756-1142-48a7-aee0-d152ea224713" class="">In a program of good <strong>spatial locality</strong>, if a memory location is referenced once, then the program is likely to <strong>reference a nearby memory location in the near future</strong>.</p></details></li></ul><ul id="9e9af330-0e18-486a-b6fa-17337fab32cd" class="toggle"><li><details open=""><summary><strong>Programs with good locality run faster</strong></summary><p id="d02872d4-4cb0-415f-ab19-13867d8af5cb" class="">In general, programs with good locality run faster than programs with poor locality.</p><p id="7f52b1f3-c717-4afd-96ed-c00fa2e61e79" class="">All levels of modern computer systems are designed to exploit locality :</p><ul id="9e38b781-49f2-4f23-8226-61960556bfa4" class="bulleted-list"><li style="list-style-type:disc">Hardware level : Introducing cache memories improves the speed of main memory access.</li></ul><ul id="67ad4016-bd28-4017-aea9-1e19eeda1e92" class="bulleted-list"><li style="list-style-type:disc">Operating system : OS uses the main memory as a cache for most recently referenced chunks of virtual address space or most recently used disk blocks.</li></ul><ul id="20dfde5d-009c-406a-89ab-ba9eed20efb4" class="bulleted-list"><li style="list-style-type:disc">Application programs (<em>example : Web browsers</em>) : Web browsers caches recently referenced documents on a local disk.</li></ul></details></li></ul><ul id="66591e67-46f0-4ff2-99b7-aebdea5c2ba4" class="toggle"><li><details open=""><summary><strong>Locality of References to Program Data : </strong><strong><code>sumvec</code></strong></summary><pre id="b58432d2-10ab-4559-a54f-a2eba3196991" class="code"><code>int sumvec(int v[N]){
	int i, sum = 0;

	for(i = 0; i &lt; N; ++i)
		sum += v[i];
	return sum;
}</code></pre><ul id="65dce399-b274-40f9-9b34-233a1245e623" class="bulleted-list"><li style="list-style-type:disc"><strong>Locality of each variables</strong></li></ul><p id="b6a96d62-885d-4663-af05-e54ab2843ee5" class=""><code>sum</code> : <strong>referenced once in each loop iteration</strong> ‚Üí <strong>good temporal locality</strong>, no spatial locality</p><p id="09f27568-95a7-4362-8b0d-cd2a6aae0d3e" class=""><code>v[i]</code> : each elements are referenced only once, but <strong>read sequentially </strong>‚Üí poor temporal locality, <strong>good spatial locality</strong></p><p id="b7ca052b-df9a-4fd0-a33a-76a3a20229ec" class=""><code>sumvec</code> has either good spatial or temporal locality with respect to each variable in the loop body ‚Üí <strong><code>sumvec</code></strong><strong> enjoys good locality</strong>.</p><ul id="00f039ac-c563-4c06-bbb6-1bdd21d0fc07" class="bulleted-list"><li style="list-style-type:disc"><strong>stride-</strong><strong><em>k</em></strong><strong> reference pattern</strong></li></ul><p id="ebb56f0a-b78c-4437-802c-dabc358dc75c" class=""><strong>Visiting every </strong><strong><em>k</em></strong><strong>th element</strong> of a contiguous vector is called a <strong>stride-</strong><strong><em>k </em></strong><strong>reference pattern</strong>. (<em>example : </em><em><code>sumvec</code></em><em> have a stride-1 reference pattern.</em>)</p><p id="f4fbdf78-39d1-40b0-a9ab-b7a82eb3098a" class="">In general, as the stride increases, the spatial locality decreases.</p><p id="ba42d504-f424-4e38-9711-0b59abff06b5" class="">
</p></details></li></ul><ul id="2e04a214-f862-4e2f-bd7d-0c744ba67150" class="toggle"><li><details open=""><summary><strong>Locality of  Instruction Fetches</strong></summary><p id="d1251c27-8d91-4eb2-b02b-d4d39e7a602a" class="">Program instructions are stored in memory and must be fetched by the CPU ‚Üí we can also evaluate the locality of a program.</p><p id="71722327-f97f-4074-8c6e-c080e26feff5" class="">For example, <code>sumvec</code>&#x27;s instructions in <code>for</code> loop are executed <strong>multiple times, in sequential</strong> <strong>memory order</strong> ‚Üí <strong>good spatial, temporal locality</strong>  </p><p id="59a6ff20-c35a-4ade-9a02-6b543b12d074" class="">
</p></details></li></ul></div><h2 id="5f908a9a-2346-4e26-9fac-613439c19b63" class=""><details open=""><summary><mark class="highlight-blue">6.3</mark> The Memory Hierarchy</summary></details></h2><div class="indented"><figure id="977f1829-502f-4168-8fb3-0016b3dc97ef" class="image"><a href="/assets/images/CSAPP-6/Untitled%208.png"><img style="width:480px" src="/assets/images/CSAPP-6/Untitled%208.png"/></a></figure><p id="d5e3b73d-4cb2-4c38-8a7f-2c696a7b121e" class=""><strong>Memory hierarchy</strong> is introduced to make <strong>storage technology and computer software complement each other</strong> :</p><ul id="668f8341-6400-4e16-a601-a994077e4461" class="bulleted-list"><li style="list-style-type:disc"><strong>Storage technology </strong>: <strong>Faster </strong>technologies <strong>cost more</strong> per byte and have <strong>less capacity</strong>.</li></ul><ul id="311b3401-01ec-4567-b017-adc5c7523f32" class="bulleted-list"><li style="list-style-type:disc"><strong>Computer software</strong> : Well-written programs tend to exhibit good locality. </li></ul><ul id="6b127178-c54e-446e-9ff3-e14126ba1c58" class="toggle"><li><details open=""><summary><strong>Caching in the Memory Hierarchy</strong></summary><figure id="3429ec63-cb3d-4a98-a079-b49e001968e1" class="image"><a href="/assets/images/CSAPP-6/Untitled%209.png"><img style="width:432px" src="/assets/images/CSAPP-6/Untitled%209.png"/></a></figure><p id="198052a5-5c55-4142-842a-9c945989edc4" class="">In memory hierarchy, for each <em>k</em>, the faster and smaller <strong>storage device at level </strong><strong><em>k</em></strong><strong> serves as a cache for </strong>the larger and slower <strong>storage device at level </strong><strong><em>k + 1</em></strong><strong>.</strong></p><p id="70f3cde4-58e5-49b9-ba75-5b8ec756f2cc" class="">The <strong>storage at level </strong><strong><em>k+1</em></strong> is partitioned into contiguous chunks of data objects called <strong>blocks</strong>, while the <strong>storage at level </strong><strong><em>k</em></strong><strong> </strong>is partitioned into a <strong>smaller set of blocks</strong> that are the <strong>same size</strong> as the blocks at level <em>k+1</em>. </p><p id="c4adc338-4520-4d85-b4e1-a6550289d99f" class="">At any point, <strong>the cache at level </strong><strong><em>k</em></strong><strong> contains copies of a subset of the blocks from level </strong><strong><em>k+1</em></strong><em>. </em>Data are always copied back and forth between level <em>k</em> and level <em>k + 1</em> in <strong>block-size transfer units</strong>. </p><p id="2003bb4e-3e07-4fe4-88bc-ec1a4aaf5209" class="">While the block size is <strong>fixed between any particular pair of adjacent levels </strong>in the hierarchy, <strong>other pairs of levels can have different block sizes</strong>. <strong>Devices lower in the hierarchy</strong> have longer access times, and thus tend to <strong>use larger block sizes</strong> to amortize these longer access times.</p><p id="f5aae64c-7151-4931-a458-5790c9ddae71" class="">(<em>example : L0 ‚Üî L1 : word-size, L1 ‚Üî L2 : tens of bytes, L5 ‚Üî L4 : hundreds or thousands of bytes</em>)</p><ul id="c4dfd21a-f7cd-4916-bd5d-ef24a8610c03" class="bulleted-list"><li style="list-style-type:disc"><strong>Cache Hits</strong></li></ul><p id="61223d3c-eda8-4016-b9d9-0de7c5d67e49" class=""><em> </em>When a program needs a particular data object <em>d</em> from level <em>k + 1</em>, it first looks for <em>d </em>in one of the blocks stored at level <em>k</em>. If <strong><em>d </em></strong><strong>happens to be cached at level </strong><strong><em>k</em></strong>, then we have a <strong>cache hit</strong>.</p><ul id="4d9e48c6-42da-45bd-909f-bc624de52ddc" class="bulleted-list"><li style="list-style-type:disc"><strong>Cache Misses</strong></li></ul><p id="a18856c8-e3c3-4240-bfbd-89d27717d7f7" class="">If <strong><em>d</em></strong><strong> is not cached at level </strong><strong><em>k</em></strong>, then we have a <strong>cache miss</strong> - the cache at level <em>k</em> fetches the block containing <em>d</em> from the cache at level <em>k + 1</em>, possibly <strong>overwriting an existing block</strong> if the level <em>k</em> cache is already full (<strong>evicting</strong>).</p><p id="8ffead72-38c3-4e38-85af-a76620f71e3e" class="">The decision about which block to replace is governed by the <strong>cache‚Äôs replacement policy</strong>.</p><p id="1cdb1dd9-5c8d-4cf5-bbec-30f65646f7c3" class="">(<em>example : </em><strong><em>random replacement poilcy</em></strong><em> choose a </em><strong><em>random victim block</em></strong><em>, and </em><strong><em>least recently used (LRU) replacement policy</em></strong><em> choose the block that was </em><strong><em>last accessed the furthest</em></strong><em> in the past.)</em></p><ul id="4973bf42-fbfe-4d2b-be4f-4d8588e7a743" class="bulleted-list"><li style="list-style-type:disc"><strong>Kinds of Cache Misses</strong><ul id="bbec3983-a9e6-477d-9f3c-e26530dade82" class="bulleted-list"><li style="list-style-type:circle"><strong>Cold Miss</strong></li></ul><p id="17a481b8-c635-4f36-a345-224cc88ce109" class="">An <strong>empty cache</strong> is referred to as a <strong>cold cache</strong> - Cache misses due to empty cache are called <strong>cold misses</strong>.</p><ul id="a71e68f0-6f62-4dda-ab81-7dfd9df19be0" class="bulleted-list"><li style="list-style-type:circle"><strong>Conflict Miss</strong></li></ul><p id="382d91e7-dd46-4660-b123-488b4eafd949" class="">Cache at level k‚Äôs <strong>placement policy</strong> determines <strong>where to place the block it has retrieved from level </strong><strong><em>k + 1</em></strong><strong>.</strong> </p><p id="56ca11fe-2591-4f9e-93d9-791e047b32d0" class="">Allowing any block from level <em>k + 1</em> to be stored in any block at level <em>k</em> is too expensive for hardware caches ‚Üí Hardware caches typically implement a policy that <strong>restricts a particular block at level </strong><strong><em>k + 1</em></strong><strong> to a small subset of the blocks at level </strong><strong><em>k</em></strong>. (<em>example : A block i at level k + 1 must be placed in block (i mod 4) at level k.)</em></p><p id="24e1545a-d572-4d8f-8875-0f4cc4088d08" class="">Conflict miss occurs when the <strong>cache is large enough</strong> to hold the referenced data objects, but because <strong>they map to the same cache block</strong>, the <strong>cache keeps missing</strong>.</p><ul id="fe8fd06b-a889-4572-ad58-5aaa777b84d6" class="bulleted-list"><li style="list-style-type:circle"><strong>Capacity Miss</strong></li></ul><p id="a957a55f-414a-473b-931a-f2d16a797a75" class="">Programs often run as <strong>a sequence of phases</strong> <strong>where each phase accesses some reasonably constant set of cache blocks</strong>. (<em>example : loops</em>) - This set of blocks is called the <strong>working set</strong> of the phase.</p><p id="b388b012-d51d-440a-986c-29f9591a6eb2" class=""><strong>When the size of the working set exceeds the size of the cache</strong>, the cache will experience what are known as <strong>capacity misses</strong>.</p></li></ul><ul id="1448c7f6-e77c-4dcb-bce1-a6c3929fbb01" class="bulleted-list"><li style="list-style-type:disc"><strong>Cache Management</strong></li></ul><p id="c9b18403-e34d-4efb-8d6b-5ce389320a91" class="">At each level, some form of logic must <strong>manage </strong>the cache - <strong>partitioning </strong>the cache storage into <strong>blocks</strong>, <strong>transferring blocks </strong>between different levels, <strong>deciding </strong>when there are <strong>hits and misses</strong>, and <strong>dealing </strong>with them. The logic that manages the cache can be <strong>hardware</strong>, <strong>software</strong>, or a <strong>combination of the two</strong> :<div class="indented"><ul id="b45f8a7b-563b-47b4-9d33-2f8172702729" class="bulleted-list"><li style="list-style-type:disc"><strong>Compiler ‚Üí register file </strong>: compiler decides when to issue loads when there are misses, and determines which register to store the data in.</li></ul><ul id="8f708ce2-93c5-41ed-bd7d-11fdf9a30dfa" class="bulleted-list"><li style="list-style-type:disc"><strong>Hardware ‚Üí L1, L2, L3</strong></li></ul></div></p><ul id="6a669298-4f3a-47d8-b9c6-81b3881a7631" class="bulleted-list"><li style="list-style-type:disc"><strong>Caching and Locality</strong><ul id="381f8695-37b1-45fb-8e28-bc5777e1e2fc" class="bulleted-list"><li style="list-style-type:circle">Caching exploits <strong>temporal locality</strong></li></ul><p id="52c37849-e408-4b25-a6b3-63b6c1e2b430" class="">Once a data object has been copied into the cache on the first miss, we can expect <strong>a number of subsequent hits </strong>on that object. ‚Üí These subsequent hits can be served <strong>much faster</strong> than the original miss.</p><ul id="03d8bfa2-4ad1-40c1-94fd-c0a980caa13f" class="bulleted-list"><li style="list-style-type:circle">Caching exploits <strong>spatial locality</strong></li></ul><p id="d76c3e52-ae1a-4909-b4ee-cb7f82f36870" class=""><strong>Blocks </strong>usually contain <strong>multiple data objects</strong> ‚Üí The cost of copying a block after a miss will be amortized by <strong>subsequent references to other objects within that block</strong>.</p><p id="46ebfd16-366a-4417-8348-d14a385c8235" class="">
</p></li></ul></details></li></ul></div><h2 id="ec451208-9018-4d0d-a52f-4ab4c83c7c95" class=""><details open=""><summary><mark class="highlight-blue">6.4 </mark>Cache Memories</summary></details></h2><div class="indented"><ul id="7ddfd8c9-0add-486e-9544-0cb3ba950aed" class="toggle"><li><details open=""><summary><strong>Generic Cache Memory Organization</strong></summary><figure id="1f939d15-1fc7-47f1-92f1-6b323b3de4b8" class="image"><a href="/assets/images/CSAPP-6/Untitled%2010.png"><img style="width:336px" src="/assets/images/CSAPP-6/Untitled%2010.png"/></a></figure><p id="a3e8ca50-9a1e-4ecf-896d-1039b0a96c92" class="">In a system where each <strong>memory address</strong> has <strong><em>m</em></strong><strong> bits</strong> that form <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><msup><mn>2</mn><mi>m</mi></msup></mrow><annotation encoding="application/x-tex">M=2^m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span></span></span></span></span><span>Ôªø</span></span> unique addresses, a cache is organized as an array of <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><msup><mn>2</mn><mi>s</mi></msup></mrow><annotation encoding="application/x-tex">S=2^s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span></span></span></span></span><span>Ôªø</span></span> <strong>cache sets</strong>. Each set consists of<strong> </strong><strong><em>E</em></strong> <strong>cache lines</strong>. </p><p id="6c7ca952-eead-4582-8a1e-40ae4ee2e6a0" class="">Each line consists of :</p><ul id="02f80e88-87de-47cd-b3e7-6e227f39496b" class="bulleted-list"><li style="list-style-type:disc">A <strong>data block of </strong><strong><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><msup><mn>2</mn><mi>b</mi></msup></mrow><annotation encoding="application/x-tex">B=2^b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span></span></span></span></span><span>Ôªø</span></span></strong><strong> bytes</strong></li></ul><ul id="c8049964-331e-413d-85e7-c80dd0b6fe57" class="bulleted-list"><li style="list-style-type:disc">A <strong>valid bit</strong> that indicates whether or not the line contains meaningful information</li></ul><ul id="2634339a-c083-4ed1-860f-cec5a655e50d" class="bulleted-list"><li style="list-style-type:disc"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mi>m</mi><mo>‚àí</mo><mo stretchy="false">(</mo><mi>b</mi><mo>+</mo><mi>s</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">t=m-(b+s)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mclose">)</span></span></span></span></span><span>Ôªø</span></span> <strong>tag bits</strong> that uniquely identify the block stored in the cache line.</li></ul><p id="5165d617-dfd0-4d04-b789-2df29f1200bb" class="">A cache‚Äôs organization can be characterized by the tuple<strong> </strong><strong><em>(S, E, B, m)</em></strong>. The <strong>capacity </strong>of a cache, <em>C, </em>is stated in terms of <strong>the aggregate size of all the blocks</strong> ‚Üí <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mi>S</mi><mo>√ó</mo><mi>E</mi><mo>√ó</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">C=S\times E\times B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span><span>Ôªø</span></span>.</p><p id="197d8267-540b-44ac-bcfa-3220643561b8" class="">Cache is organized so that it can <strong>find the requested word</strong> by simply <strong>inspecting the bits of the address</strong>, similar to a hash table. </p><p id="1292e9a1-1bdc-4514-8985-6f74082ebeb3" class=""><strong><em>m</em></strong><strong> address bits</strong> are partitioned into <strong>three fields</strong> :</p><ul id="950f2a16-0686-4218-9a84-97aa4949541a" class="bulleted-list"><li style="list-style-type:disc"><strong><em>s</em></strong><strong> set index bits</strong> form an <strong>index to the array of </strong><strong><em>S</em></strong><strong> sets</strong> - they tell us which set the word must be stored in when interpreted as an <strong>unsigned integer</strong>.</li></ul><ul id="099a22a1-2be6-4b51-9f0c-1ab4399a3785" class="bulleted-list"><li style="list-style-type:disc"><strong><em>t</em></strong><strong> tag bits</strong> tell us <strong>which line in the set contains the word : </strong>A line in the set contains the word ‚Üî the <strong>valid bit </strong>is set &amp;&amp; <strong>the tag bits in the line == the tag bits in the address</strong></li></ul><ul id="d7deaa6b-e39d-4518-a888-18eb36a35787" class="bulleted-list"><li style="list-style-type:disc"><strong><em>b </em></strong><strong>block offset bits</strong> give us the <strong>offset of the word </strong>in the <em>B-</em>byte data block.</li></ul></details></li></ul><ul id="d959c61a-e4dc-4faa-96fd-e6438824aaab" class="toggle"><li><details open=""><summary><strong>Direct-Mapped Caches</strong></summary><p id="426e67b9-1e01-4abd-9eb1-5affea56c681" class=""><strong>Direct-Mapped cache</strong> refers to a cache with exactly <strong>one line per set</strong>. (<strong><em>E</em></strong><strong>=1</strong>)</p><ul id="564bc4a2-54de-427b-aa55-3cdff9f69d01" class="bulleted-list"><li style="list-style-type:disc">The process that a cache determines <strong>whether a request is a hit or a miss</strong> and then <strong>extracts the</strong> <strong>requested word </strong><strong><em>w</em></strong><strong> </strong>:<ol type="1" id="9ac8b2d0-1a6e-4eff-b361-986fd00d177e" class="numbered-list" start="1"><li><strong>Set Selection</strong> in Direct-Mapped Caches</li></ol><figure id="a2d63ca1-a3ee-4ed8-a214-4fead72384a8" class="image"><a href="/assets/images/CSAPP-6/Untitled%2011.png"><img style="width:528px" src="/assets/images/CSAPP-6/Untitled%2011.png"/></a></figure><p id="bb8d765e-fd3b-4831-b47e-02bd93988f9c" class="">The cache extracts the <strong><em>s </em></strong><strong>set index bits</strong> from the middle of the address for <em>w.</em> These bits are interpreted as an <strong>unsigned integer</strong> <strong>that corresponds to a set number</strong>.</p><ol type="1" id="e1e0ca78-bf3e-48ed-8030-140a9d5ba7fb" class="numbered-list" start="2"><li><strong>Line Matching</strong> in Direct-Mapped Caches</li></ol><figure id="8bdf7ed7-3abd-48f7-ab2a-4eff3dfe189d" class="image"><a href="/assets/images/CSAPP-6/Untitled%2012.png"><img style="width:480px" src="/assets/images/CSAPP-6/Untitled%2012.png"/></a></figure><p id="2656edbe-6918-45a5-b072-dd667e223dd2" class="">Determining if a copy of the word <em>w</em> is stored in one of the cache lines : A copy of <em>w</em> is contained in the line ‚Üî the <strong>valid bit </strong>is set &amp;&amp;<strong> </strong>the <strong>tag </strong>in the cache line == the <strong>tag </strong>in the address of <em>w</em></p><ol type="1" id="55851a72-5afa-4357-803b-86d3489369ca" class="numbered-list" start="3"><li><strong>Word Selection</strong> in Direct-Mapped Caches</li></ol><p id="808e1e75-5176-462b-b72b-c3e58ad97f8a" class="">The <strong>block offset bits</strong> provide us with the offset of the first byte in the desired word ‚Üí We can determine where the desired word starts in the block.</p></li></ul><ul id="7db5b6bd-ee47-499c-a081-17fac8a69ecb" class="bulleted-list"><li style="list-style-type:disc"><strong>Line Replacement</strong> on Misses in Direct-Mapped Caches<p id="e9ff1247-9b81-4dfb-8b4b-d7b8089f7556" class="">If the <strong>set is full of valid cache lines</strong>, one of the existing lines must be evicted - For a direct-mapped cache, the replacement is trivial:<strong> the current line is replaced by the new line</strong>.</p></li></ul><ul id="13e71b50-951f-4026-a620-1927067b9749" class="bulleted-list"><li style="list-style-type:disc"><strong>Example Direct-Mapped Cache : </strong><strong><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>S</mi><mo separator="true">,</mo><mi>E</mi><mo separator="true">,</mo><mi>B</mi><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>4</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>4</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(S, E, B, m) = (4, 1, 2, 4)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">4</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">4</span><span class="mclose">)</span></span></span></span></span><span>Ôªø</span></span></strong><figure id="f8dbe20b-19d5-459e-8ae7-90d4e06377ee" class="image"><a href="/assets/images/CSAPP-6/Untitled%2013.png"><img style="width:384px" src="/assets/images/CSAPP-6/Untitled%2013.png"/></a></figure><p id="e9a5ad0c-bdef-4e11-8b86-6757797fac0a" class=""><strong>The concatenation of the tag and index bits</strong> uniquely <strong>identifies each block</strong> in memory. (<em>example : block 0 consists of addresses 0 and 1, block 1 consists of addresses 2 and 3, and so on.)</em></p><p id="74ec2bd0-8063-49bd-b00c-6309361cfb42" class="">There are 8 memory blocks but only 4 cache sets ‚Üí <strong>multiple blocks map to the same cache set</strong>. (<em>example : blocks 0 and 4 both map to set 0.)</em></p><p id="7e50bb93-8d05-4517-9364-ee50e0925dc9" class="">Blocks that map to the same cache set are <strong>uniquely identified by the tag</strong>. (<em>example : block 0 has a tag bit of 0 while block 4 has a tag bit of 1.)</em></p></li></ul><ul id="97fe4a5a-3b99-4974-b8f1-88b301dae339" class="bulleted-list"><li style="list-style-type:disc"><strong>Conflict Misses</strong> in Direct-Mapped Caches : <code>dotprod</code><pre id="017944ad-5454-4700-a23e-a7443ce30696" class="code"><code>float dotprod(float x[8], float y[8]){
	float sum = 0.0;
	int i;
	for(i = 0; i &lt; 8; i++)
		sum += x[i] * y[i];
	return sum;
}</code></pre><p id="543f36ee-2641-4868-b907-3d20db38f671" class="">This function has <strong>good spatial locality</strong> ‚Üí we might expect it to enjoy a good number of cache hits. However, this is <strong>not </strong>always true.</p><p id="9982d612-a59c-412d-9618-e56bd55b5759" class="">Suppose that floats are 4 bytes, that <code>x</code> is loaded into the 32 bytes of contiguous memory starting at address 0, that y starts immediately after <code>x</code> at address 32, that a block is 16 bytes and that the cache consists of 2 sets, for a total cache size of 32 bytes. Given these assumptions, each <code>x[i]</code> and <code>y[i]</code> will map to the identical cache set :</p><figure id="de8eb74a-d786-4dfb-95ec-bf53a3428393" class="image"><a href="/assets/images/CSAPP-6/Untitled%2014.png"><img style="width:528px" src="/assets/images/CSAPP-6/Untitled%2014.png"/></a></figure><p id="f94493e0-83c1-460a-a90c-ff73ceb62b8e" class="">At run time, the first reference to <code>x[0]</code> leads to a <strong>cache miss</strong> that causes <strong>the block containing </strong><strong><code>x[0]</code></strong><strong> ~ </strong><strong><code>x[3]</code></strong> to be loaded into <strong>set 0.</strong> The next reference to <code>y[0]</code> leads to another miss that causes <strong>the </strong><strong><code>y[0]</code></strong><strong> ~ </strong><strong><code>y[3]</code></strong><strong> block </strong>to be copied into <strong>set 0</strong>, <strong>overwriting the values of </strong><strong><code>x</code></strong><strong> that were copied in by the previous reference</strong>. During the next iteration, the reference to <code>x[1]</code> misses, which causes the <code>x[0]</code> ~ <code>x[3]</code> block to be loaded back into set 0, <strong>overwriting the </strong><strong><code>y[0]</code></strong><strong> ~ </strong><strong><code>y[3]</code></strong><strong> block. ‚Üí Thrashing Conflict Miss </strong>(A cache is <strong>repeatedly loading and evicting</strong> <strong>the same sets</strong> of cache blocks.)</p><p id="60a522c1-afbb-4170-96c8-f0c456d09e16" class="">Even though the program has good spatial locality and we have room in the cache to hold the blocks, each reference can result in a <strong>conflict miss</strong> because <strong>the blocks map to the same cache set</strong>. </p><ul id="1458d16f-d85a-4e65-af2c-b417f1a3712b" class="bulleted-list"><li style="list-style-type:circle"><strong>Solution </strong>: Put <em>B </em>bytes of <strong>padding </strong>at the end of each array.</li></ul><figure id="a3eb9cd1-1b83-4875-8913-6494b8a916e9" class="image"><a href="/assets/images/CSAPP-6/Untitled%2015.png"><img style="width:528px" src="/assets/images/CSAPP-6/Untitled%2015.png"/></a></figure><p id="49ea3587-3d4b-4bd8-aabf-535d43ce6d2f" class="">If we define <code>x</code> as <strong><code>float x[12]</code></strong>, the mapping of array elements to sets change as above. ‚Üí <code>x[i]</code> and <code>y[i]</code> now map to different sets, which eliminates the thrashing conflict misses.</p></li></ul></details></li></ul><ul id="30f42543-34e1-4c33-b185-b4670853a0e4" class="toggle"><li><details open=""><summary><strong>Set Associative Caches</strong></summary><figure id="e94545fc-dced-4938-9b34-a3d970d1d309" class="image"><a href="/assets/images/CSAPP-6/Untitled%2016.png"><img style="width:384px" src="/assets/images/CSAPP-6/Untitled%2016.png"/></a></figure><p id="c081e862-6de7-4587-b0a6-b6cdedd2032f" class=""><strong>Set associative cache</strong> is a cache that <strong>each set holds more than one cache line</strong>. (<style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>&lt;</mo><mi>E</mi><mo>&lt;</mo><mi>C</mi><mi mathvariant="normal">/</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">1&lt;E&lt;C/B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68354em;vertical-align:-0.0391em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span><span>Ôªø</span></span>) ‚Üí Can solve the problem with <strong>conflict misses </strong>in <strong>direct-mapped caches</strong>.</p><ul id="e6ec3c5b-1a17-4d11-aaf0-88c58aa0ca96" class="bulleted-list"><li style="list-style-type:disc"><strong>Set Selection</strong> in Set Associative Caches<p id="5b94830c-ea65-447f-98b2-f6c3ca9a8ba2" class="">Set selection is identical to a direct-mapped cache.</p></li></ul><ul id="2b4374e5-c48c-4228-80d3-074f1d01bd7d" class="bulleted-list"><li style="list-style-type:disc"><strong>Line Matching</strong> and <strong>Word Selection</strong> in Set Associative Caches<figure id="f0c9dcfb-ca7a-4dee-930c-802471217b29" class="image"><a href="/assets/images/CSAPP-6/Untitled%2017.png"><img style="width:528px" src="/assets/images/CSAPP-6/Untitled%2017.png"/></a></figure><p id="3262a1e8-0421-42d2-ae12-6008e7bdfd62" class="">The cache must <strong>search each line</strong> in the set for <strong>a valid line whose tag matches the tag in the address</strong>. ‚Üí If the cache finds such a line, we have a <strong>hit</strong>. ‚Üí The <strong>block offset</strong> selects a word from the block. </p></li></ul><ul id="d03399b9-e40c-4ed2-b153-1ec67b39c522" class="bulleted-list"><li style="list-style-type:disc"><strong>Line Replacement on Misses</strong> in Set Associative Caches<p id="45df44b7-ce05-446f-a4cc-d0aea18381b4" class="">If we have a <strong>miss</strong>, we have to <strong>evict some line</strong>, and retrieve the requested block. Some sophisticated <strong>replacement policy</strong> draw on the <strong>principle of locality</strong> to try to <strong>minimize the probability that the replaced line will be referenced in the near future</strong>.</p><ul id="ef51eb63-91c8-46e8-aa84-8ca525eee4fe" class="bulleted-list"><li style="list-style-type:circle">Least frequently used (LFU) policy : replace the line that has been referenced the fewest times over some past time window.</li></ul><ul id="11c12eb4-ed2f-43a2-97ac-aa32ed036f5e" class="bulleted-list"><li style="list-style-type:circle">Least recently used (LRU) policy : replace the line that was last accessed the furthest in the past.</li></ul></li></ul></details></li></ul><ul id="e7e34a83-4180-447f-bc7a-89cd5ed53ccb" class="toggle"><li><details open=""><summary><strong>Fully Associative Caches</strong></summary><figure id="fbacf513-1fb4-4be0-90ea-116d5583cd81" class="image"><a href="/assets/images/CSAPP-6/Untitled%2018.png"><img style="width:384px" src="/assets/images/CSAPP-6/Untitled%2018.png"/></a></figure><p id="00c9beb4-1ecb-42c7-8d35-585e737f91ce" class="">A fully associative cache consists of a single set that contains all of the cache lines. (<style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mi>C</mi><mi mathvariant="normal">/</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">E=C/B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span><span>Ôªø</span></span>)</p><ul id="1587af8c-6ed9-4767-9e1a-867c9e9c11c9" class="bulleted-list"><li style="list-style-type:disc"><strong>Set Selection</strong> in Fully Associative Caches<p id="49da99c2-e147-47cb-b133-8ff034c4807c" class="">Set selection in fully associative cache is trivial because <strong>there is only one set</strong>. ‚Üí There are <strong>no set index bits</strong> in the address, which is partitioned into only a tag and a block offset.</p></li></ul><ul id="dc719f37-35ae-4ec6-8d56-bca99212d89d" class="bulleted-list"><li style="list-style-type:disc"><strong>Line Matching and Word Selection</strong> in Fully Associative Caches<p id="2e08322c-9057-4395-8a2f-8df0817dc2a7" class="">Line matching and word selection in fully associative cache work the <strong>same </strong>as with a set associative cache.</p><p id="7997b3c8-d68f-4990-a7d4-a6f2483947f5" class="">The cache circuitry must <strong>search for many matching tags in parallel</strong> ‚Üí It‚Äôs <strong>difficult </strong>and <strong>expensive </strong>to build an <strong>both large and fast associative cache</strong>. ‚Üí Fully associative caches are only appropriate for <strong>small caches.</strong></p><p id="1decd475-a61e-4080-b737-a4eceb2f90ed" class="">
</p></li></ul></details></li></ul><ul id="a2b8497b-7dd4-45aa-812c-5e111e60c823" class="toggle"><li><details open=""><summary><strong>Issues with Writes</strong></summary><ul id="d979fb4c-4c2d-418c-9dd3-6c03009ed47e" class="bulleted-list"><li style="list-style-type:disc"><strong>Write Hit</strong><p id="b939a1ab-9062-4b92-bf68-b54cb383222b" class="">When we write a word <em>w</em> that is already cached (<strong>write hit</strong>), first <strong>the cache updates its copy of </strong><strong><em>w</em></strong><em>. </em>Then, cache can do 2 things about updating the copy of <em>w</em> in <strong>the next lower level cache</strong> :</p><ul id="68f4ed5e-fa3e-46a8-888a-e6dc9811e9bf" class="bulleted-list"><li style="list-style-type:circle"><strong>Write-through</strong><p id="0bfb5c7e-b589-4ba3-ac19-f651b45dfaed" class="">After updating its copy of <em>w</em> in the cache, write-through <strong>immediately writes </strong><strong><em>w‚Äô</em></strong><strong>s cache block to the next lower level</strong>.</p><p id="a8681f99-c271-4aaf-8775-a721166d54b3" class="">Advantage : Being simple</p><p id="77a20f14-aa28-4ee6-b50e-7e7a0f822586" class="">Disadvantage : causing bus traffic <strong>with every write</strong>.</p></li></ul><ul id="5fea4545-8296-4501-9b7c-038b52e75368" class="bulleted-list"><li style="list-style-type:circle"><strong>Write-back</strong><p id="99f36748-ef42-40b5-8ec5-92874a7d279d" class="">Write-back defers the update as long as possible by writing the updated block to the next lower level <strong>only when it is evicted from the cache by the replacement algorithm</strong>.</p><p id="50f6e0fe-e4b7-4e39-a64c-9fdae8a0b129" class="">Advantage : <strong>Reducing </strong>the amount of bus traffic.</p><p id="43bb1679-31d8-450b-bf0f-56057b56f59e" class="">Disadvantage : <strong>Additional complexity</strong> - the cache must maintain an additional <strong>dirty bit</strong> for each cache line that <strong>indicates whether or not the cache block has been modified</strong>.</p></li></ul></li></ul><ul id="a1f425bb-36ae-473e-a2b0-b69ed186f8e6" class="bulleted-list"><li style="list-style-type:disc"><strong>Write Miss</strong><ul id="daa6aca2-3422-4b25-ae91-eb14e0f1670f" class="bulleted-list"><li style="list-style-type:circle"><strong>Write-allocate</strong><p id="6c6079a0-28cd-41c6-82f5-90d29411fbb5" class="">Write-allocate <strong>loads the corresponding block from the next lower level</strong> into the cache and then <strong>updates the cache block</strong>.</p><p id="9b91caf6-69c2-4d05-9452-02e4139dcf20" class=""><strong>Write-back</strong> caches are typically write-allocate.</p><p id="5a5a9af1-189d-4117-a04b-4517f01923ee" class="">Advantage : Can exploit <strong>spatial locality</strong> of writes</p><p id="ca3bbbce-3a30-4b09-a761-05f22bf4ac3d" class="">Disadvantage : <strong>Every miss results in a block transfer</strong> from the next lower level to the cache.</p></li></ul><ul id="b3bb6015-c715-47ee-9449-ea4a0abe6aa0" class="bulleted-list"><li style="list-style-type:circle"><strong>No-write-allocate</strong><p id="c37e9513-5f4d-468a-9eda-a9912cb8cc6d" class="">No-write-allocate <strong>bypasses the cache</strong> and <strong>writes the word directly to the next lower level</strong>.</p><p id="b25e9365-e13a-4f1f-ac7c-35ada60e13c2" class=""><strong>Write-through</strong> caches are typically no-write-allocate.</p></li></ul></li></ul><p id="055bd806-e63e-4836-af38-abb2ecfe7468" class="">To write cache-friendly programs, <strong>assume the write-back, write-allocate caches</strong>. - <strong>Modern </strong>computers generally uses <strong>write-back caches</strong> <strong>at all levels</strong>, and it is <strong>symmetric to the way reads are handled</strong>, in that it tries to exploit <strong>locality</strong>.</p></details></li></ul><ul id="6be03507-1e0a-41d1-9488-d6524d9f7f84" class="toggle"><li><details open=""><summary><strong>Anatomy of a Real Cache Hierarchy</strong></summary><ul id="abc0e0c1-26c7-4aa2-bf89-cdf2ef6d309b" class="bulleted-list"><li style="list-style-type:disc"><strong>i-cache</strong> : A cache that holds <strong>instructions </strong>only.</li></ul><ul id="a2a79490-d23e-4153-ad64-1e10f8999103" class="bulleted-list"><li style="list-style-type:disc"><strong>d-cache</strong> : A cache that holds <strong>program data</strong> only.</li></ul><ul id="f57822d6-40f3-4136-8fe1-00bbfa27135e" class="bulleted-list"><li style="list-style-type:disc"><strong>unified-cache</strong> : A cache that holds <strong>both </strong>instructions and data.</li></ul><figure id="82f5e58c-7fab-4e3f-9a4e-9cb6aa798087" class="image"><a href="/assets/images/CSAPP-6/Untitled%2019.png"><img style="width:288px" src="/assets/images/CSAPP-6/Untitled%2019.png"/></a></figure><p id="1774bfe2-609f-47a0-ba96-6b738d029e14" class="">Modern processors include <strong>separate i-caches and d-caches</strong> :</p><ul id="acdeb9dc-a6a5-441f-bc2c-9130d0b87c75" class="bulleted-list"><li style="list-style-type:disc">The two caches are often <strong>optimized </strong>to different access patterns and can have different block sizes, associativities, and capacities.</li></ul><ul id="d291702b-d8f5-4fbc-8fe3-b0539b6615c9" class="bulleted-list"><li style="list-style-type:disc">Having separate caches ensures that <strong>data accesses</strong> do not create <strong>conflict misses</strong> with <strong>instruction accesses</strong>, and vice versa, at the cost of a <strong>potential increase in capacity misses</strong>. </li></ul></details></li></ul><ul id="80442468-d7a9-4e79-8a50-8a1f0544c16f" class="toggle"><li><details open=""><summary><strong>Performance Impact of cache Parameters</strong></summary><p id="2497bbfe-ab68-4cb7-b2cc-c350237c2c12" class="">Cache performance is evaluated with a number of metrics:</p><ul id="9c24a321-7a09-4618-bd57-980567258bce" class="bulleted-list"><li style="list-style-type:disc"><strong>Miss rate</strong> : <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">#</mi><mtext>¬†</mtext><mi>m</mi><mi>i</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>s</mi><mi mathvariant="normal">/</mi><mi mathvariant="normal">#</mi><mtext>¬†</mtext><mi>r</mi><mi>e</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">\#\ misses/\#\ references</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">#</span><span class="mspace">¬†</span><span class="mord mathnormal">mi</span><span class="mord mathnormal">sses</span><span class="mord">/#</span><span class="mspace">¬†</span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">ere</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ces</span></span></span></span></span><span>Ôªø</span></span></li></ul><ul id="bca348ce-b449-4a85-b08b-5abecc316016" class="bulleted-list"><li style="list-style-type:disc"><strong>Hit rate</strong> : <em>1 - miss rate</em></li></ul><ul id="d2c92872-de56-4e77-9c1b-5eb8328e903c" class="bulleted-list"><li style="list-style-type:disc"><strong>Hit time</strong> : <strong>The time to</strong> <strong>deliver a word in the cache to the CPU</strong>, including the time for set selection, line identification, and word selection.</li></ul><ul id="b982ec1c-281c-4305-8109-939647c1be76" class="bulleted-list"><li style="list-style-type:disc"><strong>Miss penalty</strong> : Any additional time required because of a <strong>miss</strong>.</li></ul><p id="423d6079-bb87-4d68-9294-493c3d142e9d" class="">Some qualitative trade-offs in optimizing the cost and performance of cache memories :</p><ul id="bd60f75c-60f2-4a6f-9a23-4d530f874d9c" class="bulleted-list"><li style="list-style-type:disc">Impact of <strong>Cache Size</strong><p id="17569c26-43d4-44b0-8066-1b953d959aea" class="">Larger cache ‚Üí <strong>Increased hit rate</strong></p><p id="d2076308-d1bf-463e-82e4-1ee347c7c394" class="">Larger cache ‚Üí Harder to make memories run <strong>faster </strong>‚Üí <strong>Increased hit time</strong></p><p id="eba20d81-cb7d-4f68-be49-7fbe0a56abf4" class="">‚áí An L1 cache is smaller than an L2 cache, and an L2 cache is smaller than an L3 cache.</p></li></ul><ul id="2127776a-935f-493d-8d7a-24eb3e964c74" class="bulleted-list"><li style="list-style-type:disc">Impact of <strong>Block Size</strong><p id="0d74eb49-fdde-4d24-8f49-c68c2acc0f19" class="">Larger blocks ‚Üí Can exploit <strong>spatial locality</strong> that might exist in a program ‚Üí <strong>Increased hit rate</strong></p><p id="bf236316-4fef-4e42-a7b6-b592a35b18c9" class="">Larger blocks ‚Üí For a given cache size, <strong>a smaller number of cache lines</strong> ‚Üí <strong>Decreased hit rate</strong> in programs with more <strong>temporal locality</strong> than spatial locality</p><p id="c33350ec-e849-4aca-9b0a-299865700133" class="">Larger blocks ‚Üí <strong>Larger transfer times</strong> ‚Üí <strong>Higher miss penalty</strong></p></li></ul><ul id="83e4fd4a-17d6-4b3b-b451-6cfbf7822a01" class="bulleted-list"><li style="list-style-type:disc">Impact of <strong>Associativity</strong><p id="16b32d07-786b-4bd8-ba40-16ed5b47b7c9" class="">Higher associativity ‚Üí <strong>Decreased </strong>vulnerability to thrashing <strong>conflict misses</strong></p><p id="c22c53b8-09d6-4e37-8212-5e65484f2db9" class="">Higher associativity ‚Üí Requires <strong>more tag bits</strong> per line, <strong>additional LRU state bits</strong> per line, and <strong>additional control logic</strong> ‚Üí <strong>Expensive </strong>to implement and <strong>hard to make fast</strong></p><p id="fd35c163-1220-4036-841e-07e22846eba6" class="">Higher associativity ‚Üí <strong>Increased complexity </strong>‚Üí <strong>Increased hit time &amp; miss penalty</strong> (the complexity of choosing a victim line also increases.)</p><p id="937a8317-4b7b-4323-a69a-0933004abaaa" class="">‚áí Modern systems would take <strong>smaller associativity for L1 caches</strong>, where the miss penalty is only a few cycles, and a <strong>larger associativity for the lower levels</strong>, where the miss penalty is higher.</p></li></ul><ul id="bbdab155-ef17-4c31-93e4-2eb37da3b63e" class="bulleted-list"><li style="list-style-type:disc">Impact of <strong>Write Strategy</strong><ul id="0c7cdb76-c844-4aff-a261-958e244157a8" class="bulleted-list"><li style="list-style-type:circle"><strong>Write-through</strong> caches<ul id="fa540ba7-700e-441e-af14-53c3c2787cb5" class="bulleted-list"><li style="list-style-type:square"><strong>Simpler </strong>to implement</li></ul><ul id="0af80660-29ef-4928-bb83-280e1590ee1a" class="bulleted-list"><li style="list-style-type:square">Can use a <strong>write buffer</strong> that works independently of the cache to update memory</li></ul><ul id="3cb4b566-45a4-41ef-8137-e68daa5904a6" class="bulleted-list"><li style="list-style-type:square"><strong>Read misses are less expensive</strong> because they do not trigger a memory write. ‚Üí I don‚Äôt understand this part...üôÑ</li></ul></li></ul><ul id="06a88b0b-978f-44ca-b847-6ce6609ed7dc" class="bulleted-list"><li style="list-style-type:circle"><strong>Write-back</strong> caches<ul id="910fb4fa-d72b-45b2-b3a5-17fe9981c7e0" class="bulleted-list"><li style="list-style-type:square"><strong>Fewer transfers</strong> ‚Üí <strong>More bandwidth</strong> to memory for <strong>I/O devices</strong> that perform DMA.</li></ul><ul id="466a2dc5-0752-4522-a8eb-eec6428cb0dc" class="bulleted-list"><li style="list-style-type:square"><strong>Fewer transfers</strong> ‚Üí <strong>Caches further down the hierarchy</strong>, where the <strong>transfer time is high,</strong> are more likely to <strong>use write-back</strong> than write-through.</li></ul><p id="b09683ba-01fc-4ceb-a5c9-fb359c82d640" class="">
</p></li></ul></li></ul></details></li></ul></div><h2 id="171847e6-49da-42f5-8d9a-75336135caba" class=""><details open=""><summary><mark class="highlight-blue">6.5 </mark>Writing Cache-Friendly Code</summary></details></h2><div class="indented"><p id="63a510b3-806a-4ea3-b6b6-89e3d93ced40" class=""><strong>Cache-friendly</strong> code is a code that has <strong>good locality</strong>. Here is the basic approach to write cache-friendly code :</p><ol type="1" id="214d0b90-3cb3-4c35-9379-3959349d4524" class="numbered-list" start="1"><li><strong>Focus on the inner loops</strong> of the core functions, and ignore the rest.</li></ol><ol type="1" id="e14c70cc-0f39-4370-a180-d5da77e71b9a" class="numbered-list" start="2"><li><strong>Minimize the number of cache misses</strong> in each inner loop.</li></ol><ol type="1" id="26b9a503-cf62-495f-96ab-ec78067f0eda" class="numbered-list" start="3"><li><strong>Repeated references to local variables</strong> are good because the compiler can cache them in the <strong>register file</strong>. (<strong>temporal locality</strong>)</li></ol><ol type="1" id="ed29fd69-118c-49fb-81af-ef50d55a5108" class="numbered-list" start="4"><li><strong>Stride-1 reference patterns</strong> are good because caches at all levels store data as contiguous blocks. (<strong>spatial locality</strong>)<p id="8b13451e-c71f-478c-aacb-a09b9ce8b290" class="">If a cache has a block size of <em>B</em> bytes, then a <strong>stride-</strong><strong><em>k</em></strong><strong> reference pattern</strong> results in an average of  <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>w</mi><mi>o</mi><mi>r</mi><mi>d</mi><mtext>¬†</mtext><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo>√ó</mo><mi>k</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">min(1,(word\ size\times k)/B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">min</span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">d</span><span class="mspace">¬†</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span><span>Ôªø</span></span> misses per loop iteration.</p></li></ol><p id="79070401-1e33-4a47-9b2f-23eb10b453ef" class="">
</p></div><h2 id="62831b7b-fd3d-405d-871d-d4fdc4ca91f7" class=""><details open=""><summary><mark class="highlight-blue">6.6 </mark>Putting It Together: The Impact of Caches on Program Performance</summary></details></h2><div class="indented"><ul id="b14467c5-a252-484f-9f8c-1427c3c13d4e" class="toggle"><li><details open=""><summary><strong>The Memory Mountain</strong></summary><p id="99dbab64-4453-410a-8fca-280f79a16573" class="">Write a program that <strong>issued a sequence of read requests</strong> from a tight program loop, then <strong>measure the read throughput</strong> ‚Üí  We can get some insight into the performance of the memory system for that particular sequence of reads.</p><pre id="8df68a84-adcc-43a6-8646-348d73b8a757" class="code"><code>long data[MAXELEMS]; /* The global array we&#x27;ll be traversing */

/* test - Iterate over first &quot;elems&quot; elements of array &quot;data&quot; with stride of &quot;stride&quot;, using 4 x 4 loop unrolling. */
int test(int elems, int stride){
	long i, sx2 = stride * 2, sx3 = stride * 3, sx4 = stride * 4;
	long acc0 = 0, acc1 = 0, acc2 = 0, acc3 = 0;
	long length = elems;
	long limit = length - sx4;

	/* Combine 4 elements at a time */
	for(i = 0; i &lt; limit; i += sx4) {
		acc0 = acc0 + data[i];
		acc1 = acc1 + data[i + stride];
		acc2 = acc2 + data[i + sx2];
		acc3 = acc3 + data[i + sx3];
	}

	/* Finish any remaining elements */
	for(; i &lt; length; ++i){
		acc0 = acc0 + data[i];
	}
	return ((acc0 + acc1) + (acc2 + acc3));
}

/* run - Run test(elems, stride) and return read throughput. &quot;size&quot; is in bytes, &quot;stride&quot; is in array elements, and Mhz is CPU clock frequency in Mhz. */
double run(int size, int stride, double Mhz){
	double cycles;
	int elems = size / sizeof(double);
	test(elems, stride); /* Warm up the cache */
	cycles = fcyc2(test, elems, stride, 0); /* Call test(elems, stride) */
	return (size / stride) / (cycles / Mhz); /* Convert cycles to MB/s */
}</code></pre><p id="fa8277a4-8c65-466e-84d5-e10234810130" class="">The <strong><code>size</code></strong><strong> </strong>and <strong><code>stride</code></strong><strong> </strong>arguments to the <code>run</code> function allow us to <strong>control the degree of temporal and spatial locality</strong> in the resulting read sequence - Smaller values of <strong><code>size</code></strong><strong> </strong>result in better <strong>temporal locality</strong>, and smaller values of <strong><code>stride</code></strong><strong> </strong>result in better <strong>spatial locality</strong>. If we <strong>call the </strong><strong><code>run</code></strong><strong> repeatedly with different values of </strong><strong><code>size</code></strong><strong> and </strong><strong><code>stride</code></strong>, we can get a <strong>two-dimensional function of read throughput</strong> versus temporal and spatial locality : A <strong>memory mountain</strong>.</p><figure id="3b28f9a2-7ac6-4283-a784-2135956550e6" class="image"><a href="/assets/images/CSAPP-6/Untitled%2020.png"><img style="width:480px" src="/assets/images/CSAPP-6/Untitled%2020.png"/></a><figcaption>A memory mountain for an Intel Core i7 Haswell system.</figcaption></figure><p id="fe9980e6-7c90-46e2-8e07-c008cee183ec" class="">The <strong>performance of the memory system</strong> is not characterized by a single number. - It is a <strong>mountain of temporal and spatial locality</strong> whose elevations can vary by over an order of magnitude.</p></details></li></ul><ul id="7dc17f55-1455-410c-9d15-8d901ac236ec" class="toggle"><li><details open=""><summary><strong>Rearranging Loops to Increase Spatial Locality</strong></summary><p id="7704fdb5-49ca-4e32-8b98-619b2a8feb6a" class="">A <strong>matrix multiply</strong> function with several minor code changes :</p><figure id="8db792b4-88b6-4456-8138-3feb730d4865" class="image"><a href="/assets/images/CSAPP-6/Untitled%2021.png"><img style="width:480px" src="/assets/images/CSAPP-6/Untitled%2021.png"/></a></figure><p id="f3ae3bde-493c-45d6-b348-c9393e26b995" class="">Even though each version performs <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span><span>Ôªø</span></span> total operations and an <strong>identical number of adds and multiplies</strong>, there are <strong>differences in the number of accesses and the locality</strong>.</p><ul id="d93d34de-f4c2-47b6-b775-149165fc2c01" class="bulleted-list"><li style="list-style-type:disc">Version <em>ijk</em> &amp; Version <em>jik</em> : class <strong>AB</strong></li></ul><p id="ab676406-b948-40eb-83a1-80c0bfd9bb95" class=""><em>ijk &amp; jik </em>reference arrays A and B in their innermost loop. </p><p id="6d036f3e-c681-4168-be71-99b82f87bc79" class="">Each iteration performs <strong>two loads and no store</strong> operation.</p><p id="a1d5c569-63b4-417d-a3b4-96d13fc404cb" class="">The inner loops of the class AB scans a row of array A with a stride of 1. ‚Üí Each cache block holds four 8-byte words ‚Üí miss rate for A is <strong>0.25 misses per iteration</strong>.</p><p id="4cdaa846-6035-45fe-a839-82e480b30d32" class="">The inner loops of the class AB scans a column of B with a stride of n. ‚Üí n is large, each access of array B results in a miss ‚Üí miss rate for B is <strong>1 misses per iteration</strong>.</p><p id="7a979dca-8430-4dcc-a654-e5bddf5986ff" class="">‚áí <strong>total of 1.25 misses per iteration</strong>.</p><ul id="ec996c6f-795c-4460-9a6b-476dcaeda7bd" class="bulleted-list"><li style="list-style-type:disc">Version <em>jki </em>&amp; Version <em>kji </em>: class <strong>AC</strong></li></ul><p id="d5be4e67-bb83-4129-b6b1-716884cb21b3" class=""><em>jki </em>&amp; <em>kji </em>reference arrays A and C in their innermost loop.</p><p id="c1b07026-62f8-4290-b37d-c22218266544" class="">Each iteration performs <strong>two loads</strong> and <strong>one store</strong> operation.</p><p id="e4d018a8-f8ea-42ed-8a2b-6022f52b15d5" class="">The inner loop scans the columns of A and C with a stride of n. ‚Üí <strong>two misses per iteration</strong>.</p><ul id="e0be1fa6-a055-40c3-bd2e-e803b56ac8d3" class="bulleted-list"><li style="list-style-type:disc">Version <em>kij </em>&amp; Version <em>ijk </em>: class <strong>BC</strong></li></ul><p id="ceeb1f22-8714-4f68-afb3-73e6ab298a80" class="">kij &amp; ikj reference arrays B and C in their innermost loop.</p><p id="ae339c92-35e0-4db4-9a0e-70b1edc51548" class="">Each iteration performs <strong>two loads</strong> and <strong>one store</strong> operation.</p><p id="60befa37-7a6f-4141-b50a-a6aa9edd187e" class="">The inner loop scans the rows of B and C with a stride of 1. ‚Üí <strong>0.5 misses per iteration</strong>.</p><ul id="e3e5bcda-cb30-45ca-bee3-f8c403b39943" class="bulleted-list"><li style="list-style-type:disc"><strong>Performance of different versions of matrix multiply</strong><figure id="06533c70-2f95-41b7-a72c-9fca6b2a7c0a" class="image"><a href="/assets/images/CSAPP-6/Untitled%2022.png"><img style="width:384px" src="/assets/images/CSAPP-6/Untitled%2022.png"/></a></figure><ul id="1eee45fd-d2cb-4eab-84a0-eb402424d9e4" class="bulleted-list"><li style="list-style-type:circle">Pairs of versions <strong>with the same number of memory references and misses per iteration</strong> have almost <strong>identical </strong>measured performance.</li></ul><ul id="e89b264f-94b2-40f0-b2d2-76e9d22d0c05" class="bulleted-list"><li style="list-style-type:circle"><strong>Miss rate</strong> is a better predictor of performance than the total number of memory accesses. (<em>example : BC vs. AB</em>)</li></ul><ul id="7babec26-147b-4e1f-a891-2d77ea457308" class="bulleted-list"><li style="list-style-type:circle">For large values of n, the performance of class BC is <strong>constant </strong>- the <strong>prefetching hardware</strong> is smart enough to recognize the stride-1 access pattern, and fast enough to keep up with memory accesses in the tight inner loop.<p id="88a9d04c-c05f-4ab4-9e34-f6590f69878f" class="">(A <strong>hardware prefetching mechanism</strong> automatically identifies stride-1 reference patterns and attempts to fetch those blocks into the cache before they are accessed.)</p></li></ul></li></ul></details></li></ul><ul id="1c522ae1-66aa-4673-b0ce-21939f92d3de" class="toggle"><li><details open=""><summary><strong>Exploiting Locality in Your Programs</strong></summary><ul id="558e438d-3c25-482f-8592-c3b02fa5dbc5" class="bulleted-list"><li style="list-style-type:disc">Focus your attention on the <strong>inner loops</strong>, where the bulk of the computations and memory accesses occur.</li></ul><ul id="444f0864-85de-4a1b-b8e4-c240a55e84d7" class="bulleted-list"><li style="list-style-type:disc">Try to maximize the <strong>spatial locality</strong> in your programs by reading data objects with <strong>stride 1</strong>.</li></ul><ul id="d3af11fb-6ca3-4349-bef7-e6928168ff53" class="bulleted-list"><li style="list-style-type:disc">Try to maximize the <strong>temporal locality</strong> in your programs by using a data object <strong>as often as possible</strong> once it has been read from memory.</li></ul><p id="829231b4-a3fa-4a5d-ad61-9bb294aa0c7a" class="">
</p></details></li></ul></div><p id="cf3692b9-6f85-485a-aa26-a96a6f97344d" class="">
</p></div></article></body></html>